[
  {
    "objectID": "03-wealth-index.html",
    "href": "03-wealth-index.html",
    "title": "5  Wealth Indexes",
    "section": "",
    "text": "5.1 Objectives\nThis notebook documents the process of reconstructing and analyzing wealth indexes for a forthcoming study focusing on rural populations in Madagascar. Wealth indexes, particularly the wealth index factor scores, are critical for assessing household living standards and analyzing inequalities.\nThe wealth index, provided in Demographic and Health Surveys (DHS), is constructed using principal components analysis (PCA) on household characteristics such as asset ownership, housing materials, and access to water and sanitation facilities. However, differences in data availability across survey years pose challenges for longitudinal and rural-focused analyses.\nOur objective is to ensure methodological consistency to compute rural-specific wealth indexes in earlier DHS datasets.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Wealth Indexes</span>"
    ]
  },
  {
    "objectID": "03-wealth-index.html#wealth-index-variables-in-dhs",
    "href": "03-wealth-index.html#wealth-index-variables-in-dhs",
    "title": "5  Wealth Indexes",
    "section": "5.2 Wealth index variables in DHS",
    "text": "5.2 Wealth index variables in DHS\nFor DHS 2021, wealth-related variables include:\n\nHV270: A composite wealth index placing households on a continuous scale of relative wealth.\n\nHV271: The wealth index factor score used in the PCA calculation.\n\nHV270A and HV271A: Urban/rural-specific wealth index and factor scores addressing criticisms of urban bias in the general wealth index.\n\nHowever, earlier surveys lack urban/rural disaggregation:\n\nDHS 2008 includes only HV270 and HV271, without rural-specific indicators (HV270a and HV271a).\n\nDHS 1997 does not include any pre-calculated wealth variables.\n\nThe DHS webpage on wealth index construction provides valuable supplementary information, including the SPSS code for the PCA analysis and the PCA loadings for each variable in the wealth index calculation. These loadings are helpful for validating our own calculations.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Wealth Indexes</span>"
    ]
  },
  {
    "objectID": "03-wealth-index.html#challenges-and-approach",
    "href": "03-wealth-index.html#challenges-and-approach",
    "title": "5  Wealth Indexes",
    "section": "5.3 Challenges and approach",
    "text": "5.3 Challenges and approach\nFor DHS 1997 and DHS 2008, we aim to replicate the wealth index factor scores using the PCA methodology. To this end, we obtained the SPSS code used by DHS for constructing the wealth index. This code was adapted into R to align with current software practices and allow flexibility in modifying the process for rural-focused studies. However, the SPSS code was not fully explicit, particularly for earlier datasets such as DHS 1997, necessitating careful interpretation and reconstruction of the recoding operations.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Wealth Indexes</span>"
    ]
  },
  {
    "objectID": "03-wealth-index.html#methods",
    "href": "03-wealth-index.html#methods",
    "title": "5  Wealth Indexes",
    "section": "5.4 Methods",
    "text": "5.4 Methods\nWe perform two things :\n\nValidate our method by reproducing the variable already included in the datasets: HV270, HV271, HV270a, and HV271a for 2021, and HV270, HV271 for 2008\nExtending this approach to produce the variables that are missing in the datasets: HV270A HV271A for 2008, and HV270, HV271, HV270a, and HV271a for 1997\n\nTo do so, for each survey, we:\n\nStudy the SPSS programs and documentation provided by the DHS program;\nExtract and recode the corresponding variables as similarly as possible that in DHS recipes;\nCompute the PCA with the same variables;\nCompare the variable loadings with the ones provided by the DHS program;\nCompare the household wealth index scores that we calculated with the ones included in the DHS dataset when the latter are available. The comparison is performed through plots and by calculating correslation scores;\nExport the scores that we calculated and that were missing in the provided DHS datasets for further use in a related study.\n\nAll the analysis are performed with R and appropriate libraries to process data (tidyverse?), handle spss datasets (haven?), managed labelled variables and values (labelled?), and perform PCA (psych?).\n\n\nCode\n# Load necessary libraries\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(labelled)\nlibrary(psych)\nlibrary(readxl)",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Wealth Indexes</span>"
    ]
  },
  {
    "objectID": "03-wealth-index.html#reproducing-dhs-2021",
    "href": "03-wealth-index.html#reproducing-dhs-2021",
    "title": "5  Wealth Indexes",
    "section": "5.5 Reproducing DHS 2021",
    "text": "5.5 Reproducing DHS 2021\nWe begin this process with the DHS 2021 survey, for which both national and domain-specific wealth indexes (HV270, HV271, HV270A, HV271A) are available. This allows us to validate our approach by comparing reconstructed scores and loadings with those provided by DHS, before extending the methodology to earlier years\nWe begin by loading the household dataset for DHS 2021 and construct a dictionary of variables to assist with recoding. To replicate the DHS wealth index, we reproduce the transformations applied in the original SPSS script by defining helper functions to dichotomize categorical variables, handle shared sanitation facilities, categorize livestock ownership, and recode ownership of household and personal assets. These operations result in a harmonized dataset containing the same variables used in DHS’s PCA. Additional household characteristics—such as domestic worker presence and home ownership—are retrieved from the individual and men’s questionnaires and merged at the household level. Finally, we extract from the original DHS SPSS syntax the list of variables used in the PCA and remove those with zero variance before computing the first principal component, which serves as our proxy for the wealth index factor score.\n\n\nCode\n# Load the data and build a dictionnary -----------------------------------\n\n# Load DHS 2021 Data\nhh_2021 &lt;- read_dta(\"data/raw/dhs/DHS_2021/MDHR81DT/MDHR81FL.DTA\")\n\n# Filter valid households\nhh_2021 &lt;- hh_2021 %&gt;%\n  filter(hv015 == 1)\n\n# Build a variable dictionnary\ncb_hh_2021 &lt;- hh_2021 |&gt; \n  look_for() |&gt; \n  as_tibble()\n\n\n# Helper function ---------------------------------------------------------\n\n\n# Define function to dichotomize categorical variables\ndichotomize &lt;- function(data, var, condition, new_var, new_var_label) {\n  data %&gt;%\n    mutate({{ new_var }} := if_else({{ condition }}, 1, 0, missing = 0)) %&gt;%\n    labelled::set_variable_labels(!!rlang::ensym(new_var) := new_var_label) %&gt;%\n    labelled::set_value_labels(!!rlang::ensym(new_var) := c(\"No\" = 0, \"Yes\" = 1))\n}\n\n# Define a function that will reclassify if the toilet are shared\nshared_fac &lt;- function(data, var, new_var, new_var_label) {\n  data %&gt;%\n    mutate(\n      {{ new_var }} := if_else(hv225 == 1 & {{ var }} == 1, 1, 0, missing = 0),\n      {{ var }} := if_else(hv225 == 1, 0, {{ var }}, missing = 0)\n    ) %&gt;%\n    labelled::set_variable_labels(!!rlang::ensym(new_var) := new_var_label) %&gt;%\n    labelled::set_value_labels(!!rlang::ensym(new_var) := c(\"No\" = 0, \"Yes\" = 1))\n}\n\n# Function to categorize livestock counts\ncategorize_livestock &lt;- function(data, var, prefix, category_ranges, category_labels) {\n  \n  # Ensure missing values and conditions are applied first\n  data &lt;- data %&gt;%\n    mutate(\n      {{ var }} := if_else(is.na({{ var }}) | hv246 != 1, 0, {{ var }})\n    )\n  \n  # Create categorized dummy variables with the given prefix\n  for (i in seq_along(category_ranges)) {\n    new_var &lt;- paste0(prefix, \"_\", i)  # Custom prefix for output variable names\n    label &lt;- category_labels[i]\n    \n    data &lt;- data %&gt;%\n      mutate(\n        !!sym(new_var) := as.integer({{ var }} &gt;= category_ranges[[i]][1] & {{ var }} &lt;= category_ranges[[i]][2])\n      ) %&gt;%\n      set_variable_labels(!!sym(new_var) := label)\n  }\n  \n  return(data)\n}\n\n# To mimic no2zero in DHS SPSS code (our values are already coded 0 and 1)\n\nno2zero &lt;- function(data, new_var, old_var, replace_na = TRUE) {\n  data %&gt;%\n    rename({{ new_var }} := {{ old_var }}) %&gt;%\n    mutate({{ new_var }} := if_else(replace_na & is.na({{ new_var }}), 0, {{ new_var }}))\n}\n\n# Dichotomization as per SPSS original script\n# I rename the outputs to have the same as in: \n# https://www.dhsprogram.com/programming/wealth%20index/Madagascar%20DHS%202021/Madagascar%20DHS%202021.sps.txt\n\ntest &lt;- hh_2021 %&gt;%\n  \n  # Source of drinking water\n  dichotomize(hv201, hv201 == 11, QH101_11, \"Source of drinking water: Eau du robinet dans le logement\") %&gt;%\n  dichotomize(hv201, hv201 == 12, QH101_12, \"Source of drinking water: Eau du robinet dans la cour/Parcelle\") %&gt;%\n  dichotomize(hv201, hv201 == 13, QH101_13, \"Source of drinking water: Eau du robinet du voisin\") %&gt;%\n  dichotomize(hv201, hv201 == 14, QH101_14, \"Source of drinking water: Eau du robinet public/Borne fontaine\") %&gt;%\n  dichotomize(hv201, hv201 == 21, QH101_21, \"Source of drinking water: Puits à pompe ou forage\") %&gt;%\n  dichotomize(hv201, hv201 == 31, QH101_31, \"Source of drinking water: Puits creusés protégés\") %&gt;%\n  dichotomize(hv201, hv201 == 32, QH101_32, \"Source of drinking water: Puits creusés non protégés\") %&gt;%\n  dichotomize(hv201, hv201 == 41, QH101_41, \"Source of drinking water: Source protégée\") %&gt;%\n  dichotomize(hv201, hv201 == 42, QH101_42, \"Source of drinking water: Source non protégée\") %&gt;%\n  dichotomize(hv201, hv201 == 51, QH101_51, \"Source of drinking water: Eau de pluie\") %&gt;%\n  dichotomize(hv201, hv201 == 61, QH101_61, \"Source of drinking water: Camion citerne\") %&gt;%\n  dichotomize(hv201, hv201 == 62, QH101_71, \"Source of drinking water: Charette avec petite citerne/tonneau\") %&gt;%\n  dichotomize(hv201, hv201 == 43, QH101_81, \"Source of drinking water: Eau de surface/Rivière/Barrage/Lac/Mare/Canal\") %&gt;%\n  dichotomize(hv201, hv201 == 71, QH101_91, \"Source of drinking water: Eau en bouteille\") %&gt;%\n  dichotomize(hv201, hv201 == 96, QH101_96, \"Source of drinking water: Autre\") %&gt;%\n  \n  # Qui va chercher l'eau?\n  dichotomize(hv236, hv236 == 1, QH104A_1, \"Qui va chercher l'eau: Femme adulte (&gt;=15 ans)\") %&gt;%\n  dichotomize(hv236, hv236 == 2, QH104A_2, \"Qui va chercher l'eau: Homme adulte (&gt;=15 ans)\") %&gt;%\n  dichotomize(hv236, hv236 == 3, QH104A_3, \"Qui va chercher l'eau: Fille (&lt;15 ans)\") %&gt;%\n  dichotomize(hv236, hv236 == 4, QH104A_4, \"Qui va chercher l'eau: Garçons (&lt;15 ans)\") %&gt;%\n  \n  # Type of toilet facility\n  dichotomize(hv205, hv205 == 11, QH109_11, \"Type of toilet facility: Chasse d'eau - à un système d'égout\") %&gt;%\n  dichotomize(hv205, hv205 == 12, QH109_12, \"Type of toilet facility: Chasse d'eau - à une fosse septique\") %&gt;%\n  dichotomize(hv205, hv205 == 13, QH109_13, \"Type of toilet facility: Chasse d'eau - fosse d'aisance\") %&gt;%\n  dichotomize(hv205, hv205 == 14, QH109_14, \"Type of toilet facility: Chasse d'eau - à quelque chose d'autre\") %&gt;%\n  dichotomize(hv205, hv205 == 15, QH109_15, \"Type of toilet facility: Chasse d'eau - ne sait pas\") %&gt;%\n  dichotomize(hv205, hv205 == 21, QH109_21, \"Type of toilet facility: Fosses/latrines - ventilées améliorées (VIP)\") %&gt;%\n  dichotomize(hv205, hv205 == 22, QH109_22, \"Type of toilet facility: Fosses/latrines - avec dalles\") %&gt;%\n  dichotomize(hv205, hv205 == 23, QH109_23, \"Type of toilet facility: Fosses/latrines - sans dalles/trou ouvert\") %&gt;%\n  dichotomize(hv205, hv205 == 41, QH109_31, \"Type of toilet facility: Toilettes à compostage\") %&gt;%\n  dichotomize(hv205, hv205 == 42, QH109_41, \"Type of toilet facility: Seau/tinette\") %&gt;%\n  dichotomize(hv205, hv205 == 43, QH109_51, \"Type of toilet facility: Toilettes /latrines suspendues\") %&gt;%\n  dichotomize(hv205, hv205 == 31, QH109_61, \"Type of toilet facility: Pas de toilette/nature\") %&gt;%\n  dichotomize(hv205, hv205 == 96, QH109_96, \"Type of toilet facility: Autre\") %&gt;%\n  \n  # Create shared toilet facility indicators\n  shared_fac(QH109_11, QH109_11_sh, \"Type of toilet facility: Chasse d'eau - à un système d'égout - shared\") %&gt;%\n  shared_fac(QH109_12, QH109_12_sh, \"Type of toilet facility: Chasse d'eau - à une fosse septique - shared\") %&gt;%\n  shared_fac(QH109_13, QH109_13_sh, \"Type of toilet facility: Chasse d'eau - fosse d'aisance - shared\") %&gt;%\n  shared_fac(QH109_14, QH109_14_sh, \"Type of toilet facility: Chasse d'eau - à quelque chose d'autre - shared\") %&gt;%\n  shared_fac(QH109_15, QH109_15_sh, \"Type of toilet facility: Chasse d'eau - ne sait pas - shared\") %&gt;%\n  shared_fac(QH109_21, QH109_21_sh, \"Type of toilet facility: Fosses/latrines - ventilées ameliorées (VIP) - shared\") %&gt;%\n  shared_fac(QH109_22, QH109_22_sh, \"Type of toilet facility: Fosses/latrines - avec dalles - shared\") %&gt;%\n  shared_fac(QH109_23, QH109_23_sh, \"Type of toilet facility: Fosses/latrines - sans dalles/trou ouvert - shared\") %&gt;%\n  shared_fac(QH109_31, QH109_31_sh, \"Type of toilet facility: Toilettes à compostage - shared\") %&gt;%\n  shared_fac(QH109_41, QH109_41_sh, \"Type of toilet facility: Seau/tinette - shared\") %&gt;%\n  shared_fac(QH109_51, QH109_51_sh, \"Type of toilet facility: Toilettes /latrines suspendues - shared\") %&gt;%\n  shared_fac(QH109_96, QH109_96_sh, \"Type of toilet facility: Autre - shared\") %&gt;%\n  \n  # Type of cooking fuel \n  dichotomize(hv226, hv226 == 1, QH113_1, \"Type of cooking fuel: Electricité\") %&gt;%\n  dichotomize(hv226, hv226 == 2, QH113_2, \"Type of cooking fuel: Gaz propane liquifié (GPL)\") %&gt;%\n  dichotomize(hv226, hv226 == 3, QH113_3, \"Type of cooking fuel: Gaz naturel\") %&gt;%\n  dichotomize(hv226, hv226 == 4, QH113_4, \"Type of cooking fuel: Biogaz\") %&gt;%\n  dichotomize(hv226, hv226 == 5, QH113_5, \"Type of cooking fuel: Kérosène/Petrole\") %&gt;%\n  dichotomize(hv226, hv226 == 6, QH113_6, \"Type of cooking fuel: Charbon, lignite\") %&gt;%\n  dichotomize(hv226, hv226 == 7, QH113_7, \"Type of cooking fuel: Charbon de bois\") %&gt;%\n  dichotomize(hv226, hv226 == 8, QH113_8, \"Type of cooking fuel: Bois\") %&gt;%\n  dichotomize(hv226, hv226 == 9, QH113_9, \"Type of cooking fuel: Paille/Branche/Herbes\") %&gt;%\n  dichotomize(hv226, hv226 == 10, QH113_10, \"Type of cooking fuel: Résidus agricoles\") %&gt;%\n  # The commented-out SPSS variable (hv226=11) is skipped\n  dichotomize(hv226, hv226 == 95, QH113_95, \"Type of cooking fuel: Pas de repas préparé dans le ménage\") %&gt;%\n  dichotomize(hv226, hv226 == 11 | hv226 == 96, QH113_96, \"Type of cooking fuel: Autre/Bouse\") %&gt;%\n  \n  # Cows/bulls\n  categorize_livestock(hv246b, \"QH118A\",\n                       list(c(1,4), c(5,9), c(10,98)), \n                       c(\"Cows/bulls: 1-4\", \"Cows/bulls: 5-9\", \"Cows/bulls: 10+\")) %&gt;%\n  \n  # Zébus\n  categorize_livestock(hv246g, \"QH118B\",\n                       list(c(1,4), c(5,9), c(10,98)), \n                       c(\"Zébus: 1-4\", \"Zébus: 5-9\", \"Zébus: 10+\")) %&gt;%\n  \n  # Horses/donkeys/mules\n  categorize_livestock(hv246c, \"QH118C\", \n                       list(c(1,4), c(5,9), c(10,98)), \n                       c(\"Horses/donkeys/mules: 1-4\", \"Horses/donkeys/mules: 5-9\", \"Horses/donkeys/mules: 10+\")) %&gt;%\n  \n  # Goats\n  categorize_livestock(hv246d, \"QH118D\",\n                       list(c(1,4), c(5,9), c(10,98)), \n                       c(\"Goats: 1-4\", \"Goats: 5-9\", \"Goats: 10+\")) %&gt;%\n  \n  # Sheep\n  categorize_livestock(hv246e, \"QH118E\",\n                       list(c(1,4), c(5,9), c(10,98)), \n                       c(\"Sheep: 1-4\", \"Sheep: 5-9\", \"Sheep: 10+\")) %&gt;%\n  \n  # Chickens/poultry (different range)\n  categorize_livestock(hv246f, \"QH118F\", \n                       list(c(1,9), c(10,29), c(30,98)), \n                       c(\"Chickens or other poultry: 1-9\", \"Chickens or other poultry: 10-29\", \"Chickens or other poultry: 30+\")) %&gt;%\n  \n  # Ducks/geese/turkeys\n  categorize_livestock(hv246h, \"QH118G\", \n                       list(c(1,4), c(5,9), c(10,98)), \n                       c(\"Canards/Oies/Dindes: 1-4\", \"Canards/Oies/Dindes: 5-9\", \"Canards/Oies/Dindes: 10+\")) %&gt;%\n  \n  # Pigs\n  categorize_livestock(hv246i, \"QH118H\", \n                       list(c(1,4), c(5,9), c(10,98)), \n                       c(\"Cochons: 1-4\", \"Cochons: 5-9\", \"Cochons: 10+\")) %&gt;%\n  \n  # Define land area\n  mutate(\n    landarea = hv245,  # Assign hv245 to landarea\n    landarea = if_else(is.na(hv245) | hv245 &gt;= 99.8, 99.9, landarea),  # Set to 99.9 if missing or &gt;= 99.8\n    landarea = if_else(is.na(hv244) | hv244 != 1, 0, landarea)  # Set to 0 if QH119 is missing or not 1\n  ) %&gt;%\n  \n  # Household assets\n  no2zero(QH121A, hv206) %&gt;%   # Electricity\n  no2zero(QH121B, hv207) %&gt;%   # Radio\n  no2zero(QH121C, hv208) %&gt;%   # Television\n  no2zero(QH121D, hv221) %&gt;%   # Telephone (non-mobile)\n  no2zero(QH121E, hv243e) %&gt;%  # Computer\n  no2zero(QH121F, hv209) %&gt;%   # Refrigerator\n  no2zero(QH121G, sh121g) %&gt;%  # Bed\n  no2zero(QH121H, sh121h) %&gt;%  # Table\n  no2zero(QH121I, sh121i) %&gt;%  # Chair\n  no2zero(QH121J, sh121j) %&gt;%  # Sofa\n  no2zero(QH121K, sh121k) %&gt;%  # Sewing machine\n  no2zero(QH121L, sh121l) %&gt;%  # Fan\n  no2zero(QH121M, sh121m) %&gt;%  # DVD player\n  no2zero(QH121N, sh121n) %&gt;%  # Water heater\n  \n  # Personal assets\n  no2zero(QH122A, hv243b) %&gt;% # Watch\n  no2zero(QH122B, hv243a) %&gt;% # Mobile phone\n  no2zero(QH122C, hv210) %&gt;%  # Bicycle\n  no2zero(QH122D, hv211) %&gt;%  # Motorcycle or scooter\n  no2zero(QH122E, hv243c) %&gt;% # Animal drawn cart\n  no2zero(QH122F, hv212) %&gt;%  # Car or truck\n  no2zero(QH122G, hv243d) %&gt;% # Boat with motor\n  \n  # Financial acces\n  no2zero(QH123, hv247) %&gt;%   # Has a bank account\n  \n  # Main floor material\n  dichotomize(hv213, hv213 == 11, QH142_11, \"Main floor material: Terre/sable\") %&gt;%\n  dichotomize(hv213, hv213 == 12, QH142_12, \"Main floor material: Bouse\") %&gt;%\n  dichotomize(hv213, hv213 == 21, QH142_21, \"Main floor material: Planches en bois\") %&gt;%\n  dichotomize(hv213, hv213 == 22, QH142_22, \"Main floor material: Palmes/bambou\") %&gt;%\n  dichotomize(hv213, hv213 == 23, QH142_23, \"Main floor material: Nattes\") %&gt;%\n  dichotomize(hv213, hv213 == 31, QH142_31, \"Main floor material: Parquet ou bois ciré\") %&gt;%\n  dichotomize(hv213, hv213 == 32, QH142_32, \"Main floor material: Bandes de vinyles/asphalte\") %&gt;%\n  dichotomize(hv213, hv213 == 33, QH142_33, \"Main floor material: Carrelage\") %&gt;%\n  dichotomize(hv213, hv213 == 34, QH142_34, \"Main floor material: Ciment\") %&gt;%\n  dichotomize(hv213, hv213 == 35, QH142_35, \"Main floor material: Moquette\") %&gt;%\n  dichotomize(hv213, hv213 == 96, QH142_96, \"Main floor material: Autre\") %&gt;%\n  \n  # Main roof material\n  dichotomize(hv215, hv215 == 11, QH143_11, \"Main roof material: Pas de toit\") %&gt;%\n  dichotomize(hv215, hv215 == 12, QH143_12, \"Main roof material: Chaume/feuilles/herbes\") %&gt;%\n  dichotomize(hv215, hv215 == 13, QH143_13, \"Main roof material: Mottes de terre\") %&gt;%\n  dichotomize(hv215, hv215 == 21, QH143_21, \"Main roof material: Natte\") %&gt;%\n  dichotomize(hv215, hv215 == 22, QH143_22, \"Main roof material: Palme/bambou\") %&gt;%\n  dichotomize(hv215, hv215 == 23, QH143_23, \"Main roof material: Planches en bois\") %&gt;%\n  dichotomize(hv215, hv215 == 24, QH143_24, \"Main roof material: Carton\") %&gt;%\n  dichotomize(hv215, hv215 == 31, QH143_31, \"Main roof material: Tôle\") %&gt;%\n  dichotomize(hv215, hv215 == 32, QH143_32, \"Main roof material: Bois\") %&gt;%\n  dichotomize(hv215, hv215 == 33, QH143_33, \"Main roof material: Zinc/fibre de ciment\") %&gt;%\n  dichotomize(hv215, hv215 == 34, QH143_34, \"Main roof material: Tuiles\") %&gt;%\n  dichotomize(hv215, hv215 == 35, QH143_35, \"Main roof material: Ciment\") %&gt;%\n  dichotomize(hv215, hv215 == 36, QH143_36, \"Main roof material: Shingles\") %&gt;%\n  dichotomize(hv215, hv215 == 96, QH143_96, \"Main roof material: Autre\") %&gt;%\n  \n  # Main wall material\n  dichotomize(hv214, hv214 == 11, QH144_11, \"Main wall material: Pas de mur\") %&gt;%\n  dichotomize(hv214, hv214 == 12, QH144_12, \"Main wall material: Bambou/Cane/Palme/Tronc\") %&gt;%\n  dichotomize(hv214, hv214 == 13, QH144_13, \"Main wall material: Terre\") %&gt;%\n  dichotomize(hv214, hv214 == 21, QH144_21, \"Main wall material: Bambou avec boue\") %&gt;%\n  dichotomize(hv214, hv214 == 22, QH144_22, \"Main wall material: Pierres avec boue\") %&gt;%\n  dichotomize(hv214, hv214 == 23, QH144_23, \"Main wall material: Adobe non recouvert\") %&gt;%\n  dichotomize(hv214, hv214 == 24, QH144_24, \"Main wall material: Contre-Plaque\") %&gt;%\n  dichotomize(hv214, hv214 == 25, QH144_25, \"Main wall material: Carton\") %&gt;%\n  dichotomize(hv214, hv214 == 26, QH144_26, \"Main wall material: Bois de récupération\") %&gt;%\n  dichotomize(hv214, hv214 == 31, QH144_31, \"Main wall material: Ciment\") %&gt;%\n  dichotomize(hv214, hv214 == 32, QH144_32, \"Main wall material: Pierres avec chaux/ciment\") %&gt;%\n  dichotomize(hv214, hv214 == 33, QH144_33, \"Main wall material: Briques\") %&gt;%\n  dichotomize(hv214, hv214 == 34, QH144_34, \"Main wall material: Blocs de ciment\") %&gt;%\n  dichotomize(hv214, hv214 == 35, QH144_35, \"Main wall material: Adobe recouvert\") %&gt;%\n  dichotomize(hv214, hv214 == 36, QH144_36, \"Main wall material: Planches en bois/Shingles\") %&gt;%\n  dichotomize(hv214, hv214 == 37, QH144_37, \"Main wall material: Tôle\") %&gt;%\n  dichotomize(hv214, hv214 == 96, QH144_96, \"Main wall material: Autres\") %&gt;%\n  \n  # Members sleeping\n  mutate(\n    hv216 = if_else(is.na(hv216) | hv216 == 0, hv012, hv216),  # Replace hv216 if 0 or NA with hv012\n    memsleep = trunc(hv012 / hv216),  # Ensure integer values\n    memsleep = if_else(is.na(hv216) | hv216 &gt;= 99 | memsleep &gt;= 98, NA_real_, memsleep)  # Assign NA instead of 99\n  ) %&gt;%\n  set_variable_labels(memsleep = \"Number of members per sleeping room\") %&gt;%\n  \n  # Set rural / urban\n  mutate(\n    urban = as.integer(hv025 == 1),  # Urban is 1 if hv025 == 1, else 0\n    rural = as.integer(hv025 == 2)   # Rural is 1 if hv025 == 2, else 0\n  ) %&gt;%\n  \n  # Recoding of 3 variables is not documented in DHS SPSS example, although they are used in the PCA\n  no2zero(LAND, hv244) # Owns land\n\n\n# Load data for missing variables -----------------------------------------\n\n# Some variables are built with other sources than Housheold\n# We look in the individual recode\nir_2021 &lt;- read_dta(\"data/raw/dhs/DHS_2021/MDIR81DT/MDIR81FL.DTA\")\n# Build a variable dictionnary\ncb_ir_2021 &lt;- ir_2021 |&gt; \n  look_for() |&gt; \n  as_tibble()\n\n# We look in the men recode\nmr_2021 &lt;- read_dta(\"data/raw/dhs/DHS_2021/MDMR81DT/MDMR81FL.DTA\")\ncb_mr_2021 &lt;- mr_2021 |&gt; \n  look_for() |&gt; \n  as_tibble()\n\n\n# Compute DOMESTIC --------------------------------------------------------\n# Possible alternative:  v716 (husband/partner's occupation) == 91 (housekeeper)\n# or\ndomestic_ir &lt;- ir_2021 %&gt;%\n  filter(v150 == 12) %&gt;%  # Ensure not related to household head\n  group_by(v001, v002) %&gt;%\n  summarise(DOMESTIC_IR = as.integer(any(v717 == 6, na.rm = TRUE)), \n            .groups = \"drop\")\n\ndomestic_mr &lt;- mr_2021 %&gt;%\n  filter(mv150 == 12) %&gt;%  # Ensure not related to household head\n  group_by(mv001, mv002) %&gt;%\n  summarise(DOMESTIC_MR = as.integer(any(mv717 == 6, na.rm = TRUE)), \n            .groups = \"drop\")\n\ntest2 &lt;- test %&gt;%\n  mutate(DOMESTIC = 0) %&gt;%\n  left_join(domestic_ir, by = c(\"hv001\" = \"v001\", \"hv002\" = \"v002\")) %&gt;%\n  left_join(domestic_mr, by = c(\"hv001\" = \"mv001\", \"hv002\" = \"mv002\")) %&gt;%\n  mutate(\n    DOMESTIC = if_else(rowSums(select(., starts_with(\"DOMESTIC_\")), na.rm = TRUE) &gt; 0, 1, 0)\n  ) %&gt;%\n  select(-starts_with(\"DOMESTIC_\"))\n\n# mean(test2$DOMESTIC, na.rm = TRUE)\n# [1] 0.007947343\n# 0.00 reported in DHS excel table\n\n# Compute HOUSE -----------------------------------------------------------\n\nhouse_own_ir &lt;- ir_2021 %&gt;%\n  group_by(v001, v002) %&gt;%  # Group by household number\n  summarise(HOUSE_IR = as.integer(any(v745a &gt; 0, na.rm = TRUE)))  # If any member owns a house, set HOUSE = 1\n\nhouse_own_mr &lt;- mr_2021 %&gt;%\n  group_by(mv001, mv002) %&gt;%  # Group by household number\n  summarise(HOUSE_MR = as.integer(any(mv745a &gt; 0, na.rm = TRUE)))  # If any member owns a house, set HOUSE = 1\n\ntest3 &lt;- test2 %&gt;%\n  left_join(house_own_ir , by = c(\"hv001\" = \"v001\", \"hv002\" = \"v002\")) %&gt;%\n  left_join(house_own_mr , by = c(\"hv001\" = \"mv001\", \"hv002\" = \"mv002\")) %&gt;%\n  mutate(\n    HOUSE = if_else(rowSums(select(., starts_with(\"HOUSE_\")), na.rm = TRUE) &gt; 0, 1, 0)\n  ) %&gt;%\n  select(-starts_with(\"HOUSE_\"))\n\n# mean(test3$HOUSE)\n# [1] 0.5293515\n# MEan reported in DHS : 0.54\n\n\n# Compute PCA -------------------------------------------------------------\n\n\n# A function to extract variable names from SPSS code provided by DHS\nextract_variable_names &lt;- function(file_path, line_range) {\n  read_lines(file_path) %&gt;%                # Read the entire file\n    .[line_range[1]:line_range[2]] %&gt;%     # Extract the specified line range\n    str_c(collapse = \" \") %&gt;%              # Concatenate lines into a single string\n    str_split(\"\\\\s+\") %&gt;%                   # Split by whitespace\n    unlist() %&gt;%                            # Convert list to a character vector\n    discard(~ .x == \"\")                     # Remove empty elements\n}\n\n# file path of the source file\ndhs_spss_path &lt;- \"data/raw/dhs/DHS_wealth_index/Madagascar DHS 2021.sps.txt\"\n\n# variables listed in the PCA labeled \"Test\", from line 366 to 378\ntest_pca_vars &lt;- extract_variable_names(dhs_spss_path, c(366, 378))\ncommon_pca_vars &lt;- extract_variable_names(dhs_spss_path, c(407, 415))\nurban_pca_vars &lt;- extract_variable_names(dhs_spss_path, c(445, 457))\nrural_pca_vars &lt;- extract_variable_names(dhs_spss_path, c(487, 499))\n\n\nhh_2021_rec &lt;- test3 %&gt;%\n  mutate(across(all_of(common_pca_vars), ~ as.numeric(replace_na(., 0))))\n\n# Remove zero-variance variables\nzero_var_cols &lt;- hh_2021_rec %&gt;%\n  select(all_of(common_pca_vars)) %&gt;%\n  summarise(across(everything(), ~ var(., na.rm = TRUE))) %&gt;%\n  pivot_longer(everything(), names_to = \"variable\", values_to = \"variance\") %&gt;%\n  filter(variance == 0) %&gt;%\n  pull(variable)\n\ncommon_pca_vars &lt;- setdiff(common_pca_vars, zero_var_cols)  # Exclude those variables\n\n# Run PCA only on valid variables\npca_result_2021 &lt;- principal(\n  cor(hh_2021_rec %&gt;% select(all_of(common_pca_vars)), use = \"pairwise.complete.obs\"), \n  nfactors = 1, rotate = \"none\", scores = TRUE, covar = FALSE\n)\n\n\nWe first evaluate our ability to replicate the national wealth index (hv271) using a single, national-level PCA. We compare the component score coefficients published by DHS in their accompanying Excel file with the loadings obtained from our PCA on harmonized variables. This allows us to visually and statistically assess the consistency of our implementation.\n\n\nCode\nfile_path &lt;- \"data/raw/dhs/DHS_wealth_index/Madagascar DHS 2021_simplified.xlsx\"\n\n# Read the DHS PCA coefficients\ncommon_pca &lt;- read_excel(file_path, sheet = \"Common\")\n\n# Extract variable names and descriptions\ncommon_pca_clean &lt;- common_pca %&gt;%\n  mutate(\n    variable = str_extract(`Component Score Coefficient Matrix`, \"^[^ ]+\"),\n    description = str_remove(`Component Score Coefficient Matrix`, \"^[^ ]+ \")\n  )\n\n# Extract loadings from our R PCA\nr_pca_loadings &lt;- tibble(\n  variable = rownames(pca_result_2021$loadings),\n  r_pca_loading = pca_result_2021$loadings[, 1]\n)\n\n# Merge and compare\ncomparison &lt;- common_pca_clean %&gt;%\n  left_join(r_pca_loadings, by = \"variable\") %&gt;%\n  select(variable, description, `DHS Factor Score` = `Component`, r_pca_loading)\n\n# Plot the match between DHS and reproduced PCA loadings\nggplot(comparison, aes(x = as.numeric(`DHS Factor Score`), y = r_pca_loading)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", color = \"blue\", se = FALSE, linewidth = 0.2) +\n  labs(\n    title = \"DHS Loadings vs. PCA Loadings\",\n    x = \"DHS Factor Loadings\",\n    y = \"Reproduced PCA Loadings\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nCode\n# Correlation between published and reproduced PCA loadings\ncor.test(as.numeric(comparison$`DHS Factor Score`), comparison$r_pca_loading)\n\n\n\n    Pearson's product-moment correlation\n\ndata:  as.numeric(comparison$`DHS Factor Score`) and comparison$r_pca_loading\nt = 191.43, df = 118, p-value &lt; 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.9976931 0.9988818\nsample estimates:\n      cor \n0.9983938 \n\n\nThe plot and correlation results strongly support the accuracy of our implementation of the national PCA. The scatterplot shows an almost perfect linear alignment between the DHS-provided factor loadings and those we reproduced using the harmonized dataset. This is confirmed statistically by a Pearson correlation coefficient of 0.998, with a p-value &lt; 2.2e-16, indicating an extremely high degree of agreement between the two sets of loadings. This near-perfect correlation suggests that our harmonization and PCA procedure closely replicates the methodology applied by DHS for constructing the national wealth index (hv271).\nWe then compute a household-level wealth score using this national PCA and compare it to the hv271 variable in the DHS dataset.\n\n\nCode\n# Compute factor scores using national PCA\nhh_2021_rec &lt;- hh_2021_rec %&gt;%\n  mutate(factor_score = as.vector(scale(select(., all_of(common_pca_vars))) %*% pca_result_2021$loadings[, 1]))\n\n# Plot computed vs. official DHS national score\nggplot(hh_2021_rec, aes(x = hv271, y = factor_score, color = as.factor(hv025))) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"lm\", color = \"blue\", se = FALSE, linewidth = 0.2) +\n  labs(\n    title = \"hv271 vs Reproduced National Wealth Index\",\n    x = \"hv271 (Official National Wealth Score)\",\n    y = \"Computed National Factor Score\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nCode\n# Spearman correlation between computed and official national score\ncor(hh_2021_rec$hv271, hh_2021_rec$factor_score, method = \"spearman\", use = \"complete.obs\")\n\n\n[1] 0.9939895\n\n\nThe comparison between the official national wealth index (hv271) and our reconstructed factor score shows a strong positive association, both visually and statistically. The scatterplot indicates that the rank ordering of households is closely preserved, and the Spearman correlation coefficient of 0.994 suggests a very high level of concordance. While some minor deviations are visible—particularly at the distribution tails—these results support the conclusion that our implementation provides a reliable approximation of the national wealth index, suitable for rank-based analyses such as centile classification.\nWe now turn to the domain-specific PCA, in which we compute wealth scores separately for urban and rural households. This mirrors the DHS method used to construct the hv271a variable. We estimate the domain-specific PCA on each subsample, predict scores, and assess the correspondence with hv271a.\n\n\nCode\n# Recompute dataset (replace NAs with 0)\nhh_2021_rec &lt;- test3 %&gt;%\n  mutate(across(all_of(common_pca_vars), ~ as.numeric(replace_na(., 0))))\n\n# Filter variables with variance\nremove_zero_var &lt;- function(data, var_list) {\n  zero_var_cols &lt;- data %&gt;%\n    select(all_of(var_list)) %&gt;%\n    summarise(across(everything(), var, na.rm = TRUE)) %&gt;%\n    pivot_longer(everything(), names_to = \"variable\", values_to = \"variance\") %&gt;%\n    filter(variance == 0) %&gt;%\n    pull(variable)\n  setdiff(var_list, zero_var_cols)\n}\n\nurban_pca_vars &lt;- remove_zero_var(hh_2021_rec %&gt;% filter(hv025 == 1), \n                                  urban_pca_vars)\nrural_pca_vars &lt;- remove_zero_var(hh_2021_rec %&gt;% filter(hv025 == 2), \n                                  rural_pca_vars)\n\n# PCA for urban and rural\npca_urban &lt;- principal(cor(hh_2021_rec %&gt;% filter(hv025 == 1) %&gt;% \n                             select(all_of(urban_pca_vars)), \n                           use = \"pairwise.complete.obs\"),\n                       nfactors = 1, rotate = \"none\")\npca_rural &lt;- principal(cor(hh_2021_rec %&gt;% filter(hv025 == 2) %&gt;% \n                             select(all_of(rural_pca_vars)), \n                           use = \"pairwise.complete.obs\"),\n                       nfactors = 1, rotate = \"none\")\n\n# Compute scores\nhh_2021_rec &lt;- hh_2021_rec %&gt;%\n  mutate(\n    urbscore = if_else(hv025 == 1, \n                       as.vector(scale(select(., all_of(urban_pca_vars))) %*% \n                                   pca_urban$loadings[, 1]), \n                       NA_real_),\n    rurscore = if_else(hv025 == 2, \n                       as.vector(scale(select(., all_of(rural_pca_vars))) %*% \n                                   pca_rural$loadings[, 1]), \n                       NA_real_),\n    domscor = case_when(\n      hv025 == 1 ~ urbscore,\n      hv025 == 2 ~ rurscore\n    )\n  )\n\n\nWe finally compare the domain-specific score (domscor) to hv271a to assess the accuracy of our reconstruction:\n\n\nCode\n# Scatterplot: domscor vs hv271a\nggplot(hh_2021_rec, aes(x = domscor, y = hv271a)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"lm\", color = \"blue\", se = FALSE, linewidth = 0.2) +\n  facet_wrap(~ hv025, labeller = labeller(hv025 = c(\"1\" = \"Urban\", \"2\" = \"Rural\"))) +\n  labs(\n    title = \"Reconstructed Domain-Specific Score vs HV271A\",\n    x = \"Computed Domain-Specific Score\",\n    y = \"HV271A (Urban/Rural Wealth Index)\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nCode\n# Spearman correlations\nspearman_urban &lt;- cor(\n  hh_2021_rec %&gt;% filter(hv025 == 1) %&gt;% pull(hv271a),\n  hh_2021_rec %&gt;% filter(hv025 == 1) %&gt;% pull(domscor),\n  method = \"spearman\", use = \"complete.obs\"\n)\n\nspearman_rural &lt;- cor(\n  hh_2021_rec %&gt;% filter(hv025 == 2) %&gt;% pull(hv271a),\n  hh_2021_rec %&gt;% filter(hv025 == 2) %&gt;% pull(domscor),\n  method = \"spearman\", use = \"complete.obs\"\n)\n\ntibble(\n  domain = c(\"Urban\", \"Rural\"),\n  spearman_dom_vs_HV271A = c(spearman_urban, spearman_rural)\n)\n\n\n# A tibble: 2 × 2\n  domain spearman_dom_vs_HV271A\n  &lt;chr&gt;                   &lt;dbl&gt;\n1 Urban                   0.995\n2 Rural                   0.999\n\n\nWe then assess the quality of our domain-specific PCA reconstruction by comparing our computed scores to the official DHS variable hv271a, which provides separate wealth indices for urban and rural areas. The scatterplots indicate a strong concordance across both domains, and the Spearman correlation coefficients—0.995 for urban households and 0.999 for rural ones—confirm that our domain-specific factor scores closely replicate the rank ordering captured in hv271a. Although minor non-linearities are visible, particularly in the upper ranges, these results suggest that our approach captures the intended within-domain variation with a high degree of fidelity.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Wealth Indexes</span>"
    ]
  },
  {
    "objectID": "03-wealth-index.html#extending-dhs-2008",
    "href": "03-wealth-index.html#extending-dhs-2008",
    "title": "5  Wealth Indexes",
    "section": "5.6 Extending DHS 2008",
    "text": "5.6 Extending DHS 2008\nThe process involves several steps. First, we recode relevant variables from the DHS household dataset, ensuring that they aligned with the wealth index components, such as water sources, sanitation facilities, and household assets. Missing values were handled in the same way than DHS, by replacing them with either the variable mean for dichotomized variables or zero for animal husbandry-related variables.\nUsing the recoded data, we computed a correlation matrix for the selected variables and performed PCA to extract the first principal component, representing the wealth index factor. We then calculate factor scores for each household based on the PCA loadings.\nFinally, we validated our approach by comparing the PCA loadings attributed to each PCA variable with those provided by DHS. We also compare the reconstructed scores for each household with the official DHS factor scores (hv271). We provide a graphical comparison as well as a correlation test.\n\n\nCode\n# Load DHS Data (assuming already loaded as hh_2008)\nhh_2008 &lt;- read_dta(\"data/raw/dhs/DHS_2008/MDHR51DT/MDHR51FL.DTA\")\n\n# Filter valid households\nhh_2008 &lt;- hh_2008 %&gt;%\n  filter(hv015 == 1)\n\nhh_2008_rec &lt;- hh_2008 %&gt;%\n  mutate(\n    # water source\n    h2oires = if_else(hv201 == 11, 1, 0),\n    h2oyard = if_else(hv201 == 12, 1, 0),\n    h2opub = if_else(hv201 == 13, 1, 0),\n    h2owell = if_else(hv201 == 21, 1, 0),\n    h2opwell = if_else(hv201 == 31, 1, 0),\n    h2ouwell = if_else(hv201 == 32, 1, 0),\n    h2spring = if_else(hv201 %in% c(41, 42), 1, 0),\n    h2osurf = if_else(hv201 == 43, 1, 0),\n    h2ooth = if_else(hv201 &gt; 50 & hv201 &lt; 97, 1, 0),\n    # Toilet types\n    flushp = if_else((hv205 &gt; 10 & hv205 &lt; 15) & hv225 == 0, 1, 0),\n    flushs = if_else((hv205 &gt; 10 & hv205 &lt; 15) & hv225 == 1, 1, 0),\n    latvipp = if_else(hv205 == 21 & hv225 == 0, 1, 0),\n    latvips = if_else(hv205 == 21 & hv225 == 1, 1, 0),\n    latslbp = if_else(hv205 %in% c(22, 23) & hv225 == 0, 1, 0),\n    latslbs = if_else(hv205 %in% c(22, 23) & hv225 == 1, 1, 0),\n    latopp = if_else(hv205 == 24 & hv225 == 0, 1, 0),\n    latops = if_else(hv205 == 24 & hv225 == 1, 1, 0),\n    latbush = if_else(hv205 == 31, 1, 0),\n    latothp = if_else((hv205 &gt; 40 & hv205 &lt; 44) & hv225 == 0, 1, 0),\n    latoths = if_else((hv205 &gt; 40 & hv205 &lt; 44) & hv225 == 1, 1, 0),\n    # Amenities\n    electric = if_else(hv206 == 1, 1, 0),\n    radio = if_else(hv207 == 1, 1, 0),\n    tv = if_else(hv208 == 1, 1, 0),\n    fridge = if_else(hv209 == 1, 1, 0),\n    bicycle = if_else(hv210 == 1, 1, 0),\n    motobk = if_else(hv211 == 1, 1, 0),\n    car = if_else(hv212 == 1, 1, 0),\n    mphone = if_else(hv243a == 1, 1, 0),\n    watch = if_else(hv243b == 1, 1, 0),\n    bank = if_else(hv247 == 1, 1, 0),\n    # floor type variables\n    dirtfloo = if_else(hv213 %in% c(11, 12), 1, 0),\n    plnkfloo = if_else(hv213 == 21, 1, 0),\n    palmfloo = if_else(hv213 == 22, 1, 0),\n    matfloo = if_else(hv213 %in% c(23, 96), 1, 0),\n    parqfloo = if_else(hv213 == 31, 1, 0),\n    vinfloo = if_else(hv213 == 32, 1, 0),\n    tilefloo = if_else(hv213 == 33, 1, 0),\n    cemtfloo = if_else(hv213 == 34, 1, 0),\n    carpfloo = if_else(hv213 == 35, 1, 0),\n    # Cooking fuel\n    cookelec = if_else(hv226 == 1, 1, 0),\n    cooklpg = if_else(hv226 %in% c(2, 3, 4, 5), 1, 0),\n    cookcoal = if_else(hv226 %in% c(6, 7), 1, 0),\n    cookwood = if_else(hv226 == 8, 1, 0),\n    cookstrw = if_else(hv226 %in% c(9, 10, 11), 1, 0),\n    cooknone = if_else(hv226 %in% c(95, 96), 1, 0),\n    #wall materials\n    grnwall = if_else(hv214 == 12, 1, 0),\n    dirtwall = if_else(hv214 %in% c(11, 13), 1, 0),\n    bamwall = if_else(hv214 %in% c(21, 22), 1, 0),\n    rwdwall = if_else(hv214 %in% c(23, 24, 25, 26), 1, 0),\n    cmtwall = if_else(hv214 == 31, 1, 0),\n    stncwall = if_else(hv214 == 32, 1, 0),\n    brckwall = if_else(hv214 == 33, 1, 0),\n    blckwall = if_else(hv214 == 34, 1, 0),\n    woodwall = if_else(hv214 == 36, 1, 0),\n    othwall = if_else(hv214 == 96, 1, 0),\n    # roofing materials\n    natroof = if_else(hv215 %in% c(11, 12), 1, 0),\n    sodroof = if_else(hv215 == 13, 1, 0),\n    rudroof = if_else(hv215 %in% c(21, 22, 24), 1, 0),\n    plnkroof = if_else(hv215 == 23, 1, 0),\n    ironroof = if_else(hv215 %in% c(31, 95, 96), 1, 0),\n    woodroof = if_else(hv215 == 32, 1, 0),\n    cemtroof = if_else(hv215 %in% c(33, 35, 36), 1, 0),\n    tileroof = if_else(hv215 == 34, 1, 0),\n    # Handle missing values for hv216 and compute members per sleeping room\n    hv216 = if_else(is.na(hv216)|hv216 == 0, hv012, hv216),\n    memsleep = hv012 / hv216,\n    # pondération\n    hhmemwt = hv005 / 1000000 * hv012,\n    wt = hv005 / 1000000\n  )\n\n# Store variable names for reuse\ndich_vars_2008 &lt;- c(\n  \"h2oires\", \"h2oyard\", \"h2opub\", \"h2owell\", \"h2opwell\", \"h2ouwell\",\n  \"h2spring\", \"h2osurf\", \"h2ooth\", \"flushp\", \"flushs\", \"latvipp\", \"latvips\",\n  \"latslbp\", \"latslbs\", \"latopp\", \"latops\", \"latbush\", \"latothp\", \"latoths\",\n  \"electric\", \"radio\", \"tv\", \"fridge\", \"bicycle\", \"motobk\", \"car\", \"mphone\",\n  \"watch\", \"bank\", \"memsleep\", \"dirtfloo\", \"plnkfloo\", \"palmfloo\", \"matfloo\",\n  \"parqfloo\", \"vinfloo\", \"tilefloo\", \"cemtfloo\", \"carpfloo\", \"cookelec\",\n  \"cooklpg\", \"cookcoal\", \"cookwood\", \"cookstrw\", \"cooknone\", \"grnwall\",\n  \"dirtwall\", \"bamwall\", \"rwdwall\", \"cmtwall\", \"stncwall\", \"brckwall\",\n  \"blckwall\", \"woodwall\", \"othwall\", \"natroof\", \"sodroof\", \"rudroof\",\n  \"plnkroof\", \"ironroof\", \"woodroof\", \"cemtroof\", \"tileroof\"\n)\n\nanimal_husbandry_vars &lt;- c(\n  \"hv246a\", \"hv246b\", \"hv246c\", \"hv246d\", \"hv246e\", \"hv246f\", \"hv246g\", \"hv246h\"\n)\n\nall_factor_vars_2008 &lt;- c(dich_vars_2008 , animal_husbandry_vars)\n\n# Perform PCA\nperform_pca &lt;- function(data, vars) {\n  cor_matrix &lt;- cor(data %&gt;% select(all_of(vars)), use = \"complete.obs\")\n  principal(cor_matrix, nfactors = 1, rotate = \"none\", scores = TRUE, covar = FALSE)\n}\n\npca_result &lt;- perform_pca(hh_2008_rec, c(dich_vars_2008, animal_husbandry_vars))\n\n# Extract PCA loadings and compute factor scores\nhh_2008_rec &lt;- hh_2008_rec %&gt;%\n  mutate(\n    factor_score = as.vector(scale(hh_2008_rec %&gt;% select(all_of(dich_vars_2008), all_of(animal_husbandry_vars))) %*% pca_result$loadings[, 1])\n  )\n\n# Comparison and Visualization\ncomparison &lt;- tibble(\n  variable = paste0(\"Var\", seq_along(pca_result$loadings[, 1])), # Replace with actual names if needed\n  dhs_factor_score = c(0.051, 0.036, 0.044, 0.001, 0.006, -0.023, -0.027, -0.040, -0.004,\n                       0.049, 0.024, 0.005, 0.010, 0.012, 0.018, 0.011, 0.033, -0.070,\n                       0.004, 0.010, 0.096, 0.053, 0.094, 0.060, 0.035, 0.036, 0.047,\n                       0.090, 0.072, 0.067, -0.035, -0.022, 0.009, -0.022, -0.059,\n                       0.037, 0.004, 0.032, 0.066, 0.007, 0.016, 0.029, 0.084, -0.088,\n                       -0.002, 0.001, -0.035, -0.042, -0.017, 0.006, 0.047, 0.013,\n                       0.054, 0.014, 0.009, 0.008, -0.047, -0.043, -0.008, -0.007,\n                       0.085, -0.005, 0.009, 0.017, -0.017, -0.004, 0.000, -0.009,\n                       -0.009, -0.007, -0.003, 0.005), # SPSS values\n  r_pca_loading = pca_result$loadings[, 1]\n)\n\n# Plot: DHS Loadings vs PCA Loadings\nggplot(comparison, aes(x = dhs_factor_score, y = r_pca_loading)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", color = \"blue\", se = FALSE, linewidth = 0.2) +\n  labs(\n    title = \"DHS Loadings vs. PCA Loadings\",\n    x = \"DHS Factor Loadings\",\n    y = \"Reproduced PCA Loadings\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nThe graph compares the PCA loadings corresponding to each variable that we obtained from our calculations with the PCA loadings published by DHS on the webpage dedicated to wealth indexes for the Madagascar 2008 survey. Each point represents a variable included in the wealth index calculation, with the x-axis showing the official DHS-reported loadings and the y-axis showing the reproduced loadings. The near-perfect alignment indicates a very high consistency between the two sets of loadings, demonstrating that our reconstruction closely replicates the official DHS calculations. We now compute a correlation test to assess the correspondance.\n\n\nCode\n# Correlation and visualization\ncorr_2008_loadings &lt;- cor.test(comparison$dhs_factor_score, comparison$r_pca_loading)\ncorr_2008_loadings\n\n\n\n    Pearson's product-moment correlation\n\ndata:  comparison$dhs_factor_score and comparison$r_pca_loading\nt = 886.51, df = 70, p-value &lt; 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.9999286 0.9999722\nsample estimates:\n      cor \n0.9999555 \n\n\nThe Pearson correlation between the DHS-published PCA loadings and our reproduced loadings is nearly perfect at 0.99996, with a p-value less than 2.2e-16, confirming the almost perfect correspondence between the two.\nNext, we extend the verification to the observation level by comparing the factor scores generated through our procedure with the wealth index scores (hv271) provided in the DHS dataset.\n\n\nCode\n# Plot: hv271 vs Factor Score\nggplot(hh_2008_rec, aes(x = hv271, y = factor_score)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"lm\", color = \"blue\", se = FALSE, linewidth = 0.2) +\n  labs(\n    title = \"hv271 vs Computed Factor Score\",\n    x = \"hv271 (Wealth Index Score)\",\n    y = \"Computed Factor Score\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nhis graph compares the wealth index scores provided in the DHS dataset (hv271) with the factor scores computed through our reconstructed PCA process for the Madagascar 2008 survey. Each point represents a household, with the x-axis showing the DHS wealth index scores and the y-axis displaying the reproduced factor scores. The near-perfect alignment along the regression line demonstrates a very high agreement between the two scores, suggesting that our calculation method effectively replicates the wealth index values at the household level.\nWe perform a correlation test to quantify the relationship between the DHS wealth index scores (hv271) and the computed factor scores.\n\n\nCode\n# Perform a correlation test between hv271 and factor_score\ncorr_2008_obs &lt;- cor.test(hh_2008_rec$hv271, hh_2008_rec$factor_score,\n                          method = \"spearman\", use = \"complete.obs\")\ncorr_2008_obs\n\n\n\n    Spearman's rank correlation rho\n\ndata:  hh_2008_rec$hv271 and hh_2008_rec$factor_score\nS = 1996791089, p-value &lt; 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n      rho \n0.9978959 \n\n\nThe Spearman rank correlation between the official DHS wealth index score (hv271) and our reconstructed factor score for 2008 is very high (ρ = 0.998), suggesting a near-monotonic relationship between the two. Despite tied ranks in the data—common in categorical or discretized variables—the result indicates that our PCA-based replication closely approximates the household ranking used in the DHS wealth index. While this does not imply exact agreement in scale or distribution, it supports the use of the reconstructed score as a valid proxy for household wealth ordering.\nWe now turn to reconstructing the domain-specific wealth scores (hv271a), which DHS computes separately for urban and rural households using different sets of variables. To replicate this approach, we split the dataset by urban/rural status (hv025), filtered out variables with zero variance within each subgroup, and performed separate principal component analyses (PCA) for urban and rural samples. Using the resulting loadings, we computed domain-specific scores for each household (domscor), then rescaled these scores through linear transformation to approximate the scale of the DHS-provided hv271a variable. We assessed the accuracy of our reconstruction by comparing domscor with hv271a graphically and using Spearman correlation, providing an indication of how well our method reproduces the within-domain household rankings used in the original DHS analysis.\n\n\nCode\n# Ensure missing values are handled consistently\nhh_2008_rec &lt;- hh_2008_rec %&gt;%\n  mutate(across(all_of(animal_husbandry_vars), ~ if_else(is.na(.) | hv246 != 1, 0, .))) %&gt;%\n  mutate(across(all_of(dich_vars_2008), ~ replace_na(., 0)))\n\n# Function to remove zero-variance variables\nremove_zero_var &lt;- function(data, var_list) {\n  zero_vars &lt;- data %&gt;%\n    select(all_of(var_list)) %&gt;%\n    summarise(across(everything(), ~ var(., na.rm = TRUE))) %&gt;%\n    pivot_longer(everything(), names_to = \"variable\", values_to = \"variance\") %&gt;%\n    filter(variance == 0) %&gt;%\n    pull(variable)\n  \n  setdiff(var_list, zero_vars)\n}\n\n# Identify valid variables separately for urban and rural\nurban_vars &lt;- remove_zero_var(hh_2008_rec %&gt;% filter(hv025 == 1), all_factor_vars_2008)\nrural_vars &lt;- remove_zero_var(hh_2008_rec %&gt;% filter(hv025 == 2), all_factor_vars_2008)\n\n# Run PCA\npca_urban_2008 &lt;- perform_pca(hh_2008_rec %&gt;% filter(hv025 == 1), urban_vars)\npca_rural_2008 &lt;- perform_pca(hh_2008_rec %&gt;% filter(hv025 == 2), rural_vars)\n\n# Compute raw scores\nhh_2008_rec &lt;- hh_2008_rec %&gt;%\n  mutate(\n    urbscore = if_else(hv025 == 1,\n                       as.vector(scale(select(., all_of(urban_vars))) %*% pca_urban_2008$loadings[, 1]),\n                       NA_real_),\n    rurscore = if_else(hv025 == 2,\n                       as.vector(scale(select(., all_of(rural_vars))) %*% pca_rural_2008$loadings[, 1]),\n                       NA_real_)\n  )\n\n# Combine domain-specific scores\nhh_2008_rec &lt;- hh_2008_rec %&gt;%\n  mutate(\n    domscor = case_when(\n      hv025 == 1 ~ urbscore,\n      hv025 == 2 ~ rurscore\n    )\n  )\n\n# Keep only household IDs and domain-specific score\nhh_2008_hv271a &lt;- hh_2008_rec %&gt;%\n  select(hv001, hv002, hv271a = domscor)\n\n# Save for later use\nwrite_rds(hh_2008_hv271a, \"data/derived/hh_2008_hv271a.rds\")\n\n\nTo extend the DHS 2008 analysis with a domain-specific wealth index, we computed separate PCA scores for urban and rural households, based on the subset of variables used by DHS in their original index construction. We then assigned to each household a domain-specific wealth score (hv271a) using the appropriate urban or rural PCA loadings. In order to facilitate later merging with other household-level data, we retained only the unique household identifiers (hv001, hv002) along with the computed score. The resulting dataset was saved as an .rds file in the data/derived/ directory for use in downstream analyses.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Wealth Indexes</span>"
    ]
  },
  {
    "objectID": "03-wealth-index.html#calculating-dhs-1997",
    "href": "03-wealth-index.html#calculating-dhs-1997",
    "title": "5  Wealth Indexes",
    "section": "5.7 Calculating DHS 1997",
    "text": "5.7 Calculating DHS 1997\nWe apply a similar approach for 1997, considering that the DHS program included fewer variables in the computations. The recoding procedures for these variables are not provided and we figured out the procedure by analysing the recoded variable labels and the content of the 1997 questionnaire.\n\n\nCode\nhh_1997 &lt;- read_dta(\"data/raw/dhs/DHS_1997/MDHR31DT/MDHR31FL.DTA\") \n\n\nhh_1997_rec &lt;- hh_1997 %&gt;% \n  mutate(\n    # Specific to 1997 ---------------------\n    # Toilet types (latbush below)\n    fown = if_else((hv205 == 10 | hv205 == 11), 1, 0),\n    latpit  = if_else((hv205 == 20 | hv205 == 21), 1, 0),\n    latvip = if_else(hv205 == 22, 1, 0),\n    latother = if_else(hv205 == 96, 1, 0),\n    latbush = if_else(hv205 == 31, 1, 0),\n    # Phone\n    phone = if_else(hv221 == 1, 1, 0),\n    # Same as 2008 ------------------------\n    # water source\n    h2oires = if_else(hv201 == 11, 1, 0), # \"If piped drinking water in residence\"\n    h2oiwell = if_else(hv201 == 22, 1, 0), # \"If has a well in residence\"\n    h2osurf = if_else(hv201 %in% c(31, 32, 33, 34), 1, 0), # \"If uses river, canal or surface water for drinking\"\n    h2ooth = if_else(hv201 &gt; 51, 1, 0), # \"Other source of drinking water\"\n    h2ocessi = if_else(hv201 == 23, 1, 0), # \"If gets water from an open well/hole/cesspool in residence\"\n    h2orain = if_else(hv201 == 41, 1, 0), # \"If rain for drinking water\"\n    h2opub = if_else(hv201 == 13, 1, 0), # \"If uses a public faucet (piped)\"\n    h2ocesso = if_else(hv201 == 26, 1, 0), # \"If gets water from open well/hole/cesspool outside residence\"\n    h2oores = if_else(hv201 == 12, 1, 0), # \"If has piped water outside residence\"\n    h2bores = if_else(hv201 == 21, 1, 0), # \"If has borehole with pump in residence\"\n    h2oboout = if_else(hv201 == 24, 1, 0), # \"If has borehole with pump outside of residence\"\n    h2oowell = if_else(hv201 == 25, 1, 0), # \"If has well outside of residence\"\n    h2otruck = if_else(hv201 == 51, 1, 0),# \"If gets water from a tanker truck\"\n    # Amenities\n    electric = if_else(hv206 == 1, 1, 0),\n    radio = if_else(hv207 == 1, 1, 0),\n    tv = if_else(hv208 == 1, 1, 0),\n    fridge = if_else(hv209 == 1, 1, 0),\n    bicycle = if_else(hv210 == 1, 1, 0),\n    motobk = if_else(hv211 == 1, 1, 0),\n    car = if_else(hv212 == 1, 1, 0),\n    # floor type variables\n    dirtfloo = if_else(hv213 %in% c(11, 12), 1, 0),\n    woodfloo = if_else(hv213 == 21, 1, 0),\n    palmfloo = if_else(hv213 == 22, 1, 0),\n    parqfloo = if_else(hv213 == 31, 1, 0),\n    vinfloo = if_else(hv213 == 32, 1, 0),\n    tilefloo = if_else(hv213 == 33, 1, 0),\n    cemtfloo = if_else(hv213 == 34, 1, 0),\n    carpfloo = if_else(hv213 == 35, 1, 0),\n    othfloor = if_else(hv213 == 96, 1, 0),\n    # Handle missing values for hv216 and compute members per sleeping room\n    hv216 = if_else(is.na(hv216)|hv216 == 0, hv012, hv216),\n    memsleep = hv012 / hv216,\n    # pondération\n    hhmemwt = hv005 / 1000000 * hv012,\n    wt = hv005 / 1000000\n  )\n\n# Compute ownland variable \nir_1997 &lt;- read_dta(\"data/raw/dhs/DHS_1997/MDIR31DT/MDIR31FL.DTA\")\n\n# Compute ownland variable for households\nownland_by_household &lt;- ir_1997 %&gt;%\n  select(v001, v002, own_land_partner = v707, own_land_respondent = v740) %&gt;%\n  mutate(\n    # Convert to binary (1 if owns land personally or by family, 0 otherwise)\n    own_land_partner = if_else(own_land_partner %in% c(1, 2), 1, 0, missing = 0),\n    own_land_respondent = if_else(own_land_respondent %in% c(1, 2), 1, 0, missing = 0),\n    own_any_land = own_land_partner + own_land_respondent) %&gt;%\n  group_by(v001, v002) %&gt;%\n  summarise(ownland = sum(own_any_land, na.rm = TRUE)) %&gt;%\n  ungroup() %&gt;%\n  mutate(ownland = ifelse(ownland &gt; 0, 1, 0))\n\n# Add ownland variable to hh_1997 by joining on hv001 and hv002\nhh_1997_rec &lt;- hh_1997_rec %&gt;%\n  left_join(ownland_by_household, by = c(\"hv001\" = \"v001\", \"hv002\" = \"v002\"))\n# Check number of unmatched (we do not have data for all hh)\nsum(is.na(hh_1997_rec$ownland))\n\n\n[1] 1622\n\n\nCode\n# 1622\n\n# Replace NA in ownland with 0 (if household doesn't have any matching members)\nhh_1997_rec &lt;- hh_1997_rec %&gt;%\n  mutate(ownland = if_else(is.na(ownland), 0, ownland))\n\n# Define the equivalent variables for 1997 based on SPSS specification and recoded names\npca_loading_dhs &lt;- tibble::tribble(\n       ~code,                                            ~variable, ~dhs_factor,\n  \"electric\",                                    \"Has electricity\",  0.15080,\n     \"radio\",                                          \"Has radio\",  0.10360,\n        \"tv\",                                     \"Has television\",  0.13631,\n    \"fridge\",                                   \"Has refrigerator\",  0.08574,\n   \"bicycle\",                                        \"Has bicycle\",  0.04035,\n    \"motobk\",                                     \"Has motorcycle\",  0.04297,\n       \"car\",                                            \"Has car\",  0.07643,\n     \"phone\",                                      \"Has telephone\",  0.06839,\n   \"ownland\",     \"If household works own or family's agric. land\",  -0.09713,\n  \"memsleep\",                \"Number of members per sleeping room\",  -0.05370,\n   \"h2oires\",               \"If piped drinking water in residence\",  0.11394,\n  \"h2oiwell\",                         \"If has a well in residence\",  0.01202,\n   \"h2osurf\", \"If uses river, canal or surface water for drinking\",  -0.10437,\n    \"h2ooth\",                     \"Other source of drinking water\",  -0.00177,\n      \"fown\",                           \"If uses own flush toilet\",  0.09723,\n  \"h2ocessi\",    \"Water from open well/hole/cesspool in residence\",  0.00524,\n   \"latbush\",                      \"If uses bush,field as latrine\",  -0.12692,\n  \"latother\",                           \"If other type of latrine\",  0.00208,\n  \"dirtfloo\",      \"If has dirt, sand, dung as  floor in dwelling\",  -0.00042,\n  \"woodfloo\",     \"If has wood, plank principal floor in dwelling\",  0.03547,\n  \"cemtfloo\",                      \"If has cement principal floor\",  0.08999,\n  \"othfloor\",                      \"If has other type of flooring\",  -0.00141,\n   \"h2orain\",                         \"If rain for drinking water\",  -0.00163,\n    \"h2opub\",                    \"If uses a public faucet (piped)\",  0.08025,\n  \"h2ocesso\",         \"Water from open well/hole/cesspool outside\",  -0.02915,\n    \"latpit\",                   \"If uses a traditional pit toilet\",  0.08954,\n    \"latvip\",                              \"If uses a VIP latrine\",  0.00948,\n  \"parqfloo\",             \"If has parquet or polished wood floors\",  0.07280,\n  \"tilefloo\",            \"If has tiles for main flooring material\",  0.03367,\n  \"palmfloo\",          \"If has palm or bamboo for floor materials\",  -0.12683,\n  \"carpfloo\",                           \"If has carpeted flooring\",  0.01799,\n   \"h2oores\",               \"If has piped water outside residence\",  0.01861,\n   \"h2bores\",             \"If has borehole with pump in residence\",  0.01642,\n  \"h2oboout\",     \"If has borehole with pump outside of residence\",  -0.01110,\n  \"h2oowell\",                   \"If has well outside of residence\",  -0.00205,\n  \"h2otruck\",                  \"If gets water from a tanker truck\",  -0.00265\n  )\n\nall_factor_vars_1997 &lt;- pca_loading_dhs$code\n\n# Replace missing values\nhh_1997_rec &lt;- hh_1997_rec %&gt;%\n  mutate(across(all_of(all_factor_vars_1997),\n                ~ if_else(is.na(.), mean(., na.rm = TRUE), .)))\n# Perform PCA\npca_result_1997 &lt;- perform_pca(hh_1997_rec, all_factor_vars_1997)\n\n\n# Add factor scores to the dataset\nhh_1997_rec &lt;- hh_1997_rec %&gt;%\n  mutate(\n    factor_score = as.vector(scale(hh_1997_rec %&gt;% \n                                     select(all_of(all_factor_vars_1997))) %*% \n                               pca_result_1997$loadings[, 1]))\n\n# Create a tibble for DHS scores and R PCA loadings\nr_pca_loadings &lt;- tibble(\n  code = rownames(pca_result_1997$loadings),\n  r_pca_loading = as.vector(pca_result_1997$loadings[, 1])\n)\n\n# Join the tibbles and calculate differences\ncomparison &lt;- left_join(pca_loading_dhs, r_pca_loadings, by = \"code\") %&gt;%\n  mutate(difference = r_pca_loading - dhs_factor)\n\n# Plot 1: DHS Loadings vs PCA Loadings\nggplot(comparison, aes(x = dhs_factor, y = r_pca_loading)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", color = \"blue\", se = FALSE, linewidth = 0.2) +\n  labs(\n    title = \"DHS Loadings vs. PCA Loadings (1997)\",\n    x = \"DHS Factor Loadings\",\n    y = \"Reproduced PCA Loadings\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nThe graph compares the PCA loadings provided by DHS with the reproduced loadings generated through our reconstruction of the wealth index for the 1997 Madagascar survey. Each point represents a variable used in the wealth index calculation, with the x-axis displaying the DHS-provided loadings and the y-axis showing the reproduced loadings. The alignment of points along the regression line indicates a very strong correspondence between the two sets of loadings, validating our reconstruction methodology.\n\n\nCode\n\n# Calculate and print the correlation\ncorrelation &lt;- cor.test(comparison$dhs_factor, comparison$r_pca_loading, use = \"complete.obs\")\nprint(correlation)\n\n\nThe correlation test confirms the strong relationship between the DHS-provided PCA loadings and our reproduced loadings, with a correlation coefficient of 0.9929. The extremely small p-value (&lt; 2.2e-16) indicates that this correspondence is statistically significant.\nWe compute both a national and a domain-specific wealth index for the 1997 DHS dataset. Since DHS did not publish official wealth scores for this round, we generate a synthetic index following the same methodology: we perform PCA on recoded household-level variables and retain the first component as the national wealth index (saved under hv271). We also replicate the DHS practice of estimating separate scores for urban and rural households, applying PCA separately to each group and combining the resulting scores into a domain-specific index (saved under hv271a).\n\n\nCode\n# Ensure missing values are handled for all relevant variables\nhh_1997_rec &lt;- hh_1997_rec %&gt;%\n  mutate(across(all_of(all_factor_vars_1997), ~ if_else(is.na(.), mean(., na.rm = TRUE), .)))\n\n# Remove zero-variance variables by domain\nurban_vars_1997 &lt;- remove_zero_var(hh_1997_rec %&gt;% filter(hv025 == 1), all_factor_vars_1997)\nrural_vars_1997 &lt;- remove_zero_var(hh_1997_rec %&gt;% filter(hv025 == 2), all_factor_vars_1997)\n\n# PCA per domain\npca_urban_1997 &lt;- perform_pca(hh_1997_rec %&gt;% filter(hv025 == 1), urban_vars_1997)\npca_rural_1997 &lt;- perform_pca(hh_1997_rec %&gt;% filter(hv025 == 2), rural_vars_1997)\n\n# Domain-specific raw scores\nhh_1997_rec &lt;- hh_1997_rec %&gt;%\n  mutate(\n    urbscore = if_else(hv025 == 1,\n                       as.vector(scale(select(., all_of(urban_vars_1997))) %*% pca_urban_1997$loadings[, 1]),\n                       NA_real_),\n    rurscore = if_else(hv025 == 2,\n                       as.vector(scale(select(., all_of(rural_vars_1997))) %*% pca_rural_1997$loadings[, 1]),\n                       NA_real_)\n  )\n\n# Compute final scores\nhh_1997_rec &lt;- hh_1997_rec %&gt;%\n  mutate(\n    hv271 = as.vector(scale(select(., all_of(all_factor_vars_1997))) %*% pca_result_1997$loadings[, 1]), # common\n    hv271a = case_when(\n      hv025 == 1 ~ urbscore,\n      hv025 == 2 ~ rurscore\n    ) # domain-specific\n  )\n\n# Keep only identifiers and the two wealth indices\nhh_1997_pca_scores &lt;- hh_1997_rec %&gt;%\n  select(hv001, hv002, hv271, hv271a)\n\n# Save to file\nwrite_rds(hh_1997_pca_scores, \"data/derived/hh_1997_hv271_hv271a.rds\")",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Wealth Indexes</span>"
    ]
  }
]