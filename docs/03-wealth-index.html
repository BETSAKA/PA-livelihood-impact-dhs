<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Wealth Indexes – Replication package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-variable-consolidation.html" rel="next">
<link href="./02bis-spei-calculation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-treatment-assignation.html">Data preparation</a></li><li class="breadcrumb-item"><a href="./03-wealth-index.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Wealth Indexes</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Replication package</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/BETSAKA/PA-livelihood-impact-dhs" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Data preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-treatment-assignation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Treatment assignation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-spatial-covariates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatial covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02bis-spei-calculation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">SPEI Calculation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-wealth-index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Wealth Indexes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-variable-consolidation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Consolidation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Descriptive statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-sensitivity-checks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Sensitivity tests</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Interpretation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">5.1</span> Objectives</a></li>
  <li><a href="#wealth-index-variables-in-dhs" id="toc-wealth-index-variables-in-dhs" class="nav-link" data-scroll-target="#wealth-index-variables-in-dhs"><span class="header-section-number">5.2</span> Wealth index variables in DHS</a></li>
  <li><a href="#challenges-and-approach" id="toc-challenges-and-approach" class="nav-link" data-scroll-target="#challenges-and-approach"><span class="header-section-number">5.3</span> Challenges and approach</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="header-section-number">5.4</span> Methods</a></li>
  <li><a href="#reproducing-dhs-2021" id="toc-reproducing-dhs-2021" class="nav-link" data-scroll-target="#reproducing-dhs-2021"><span class="header-section-number">5.5</span> Reproducing DHS 2021</a></li>
  <li><a href="#extending-dhs-2008" id="toc-extending-dhs-2008" class="nav-link" data-scroll-target="#extending-dhs-2008"><span class="header-section-number">5.6</span> Extending DHS 2008</a></li>
  <li><a href="#calculating-dhs-1997" id="toc-calculating-dhs-1997" class="nav-link" data-scroll-target="#calculating-dhs-1997"><span class="header-section-number">5.7</span> Calculating DHS 1997</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-treatment-assignation.html">Data preparation</a></li><li class="breadcrumb-item"><a href="./03-wealth-index.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Wealth Indexes</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Wealth Indexes</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="objectives"><span class="header-section-number">5.1</span> Objectives</h2>
<p>This notebook documents the process of reconstructing and analyzing wealth indexes for a forthcoming study focusing on rural populations in Madagascar. Wealth indexes, particularly the wealth index factor scores, are critical for assessing household living standards and analyzing inequalities.</p>
<p>The wealth index, provided in Demographic and Health Surveys (DHS), is constructed using principal components analysis (PCA) on household characteristics such as asset ownership, housing materials, and access to water and sanitation facilities. However, differences in data availability across survey years pose challenges for longitudinal and rural-focused analyses.</p>
<p>Our objective is to ensure methodological consistency to compute rural-specific wealth indexes in earlier DHS datasets.</p>
</section>
<section id="wealth-index-variables-in-dhs" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="wealth-index-variables-in-dhs"><span class="header-section-number">5.2</span> Wealth index variables in DHS</h2>
<p>For <strong>DHS 2021</strong>, wealth-related variables include:</p>
<ul>
<li><strong>HV270</strong>: A composite wealth index placing households on a continuous scale of relative wealth.<br>
</li>
<li><strong>HV271</strong>: The wealth index factor score used in the PCA calculation.<br>
</li>
<li><strong>HV270A</strong> and <strong>HV271A</strong>: Urban/rural-specific wealth index and factor scores addressing criticisms of urban bias in the general wealth index.</li>
</ul>
<p>However, earlier surveys lack urban/rural disaggregation:</p>
<ul>
<li><strong>DHS 2008</strong> includes only HV270 and HV271, without rural-specific indicators (HV270a and HV271a).<br>
</li>
<li><strong>DHS 1997</strong> does not include any pre-calculated wealth variables.</li>
</ul>
<p>The <a href="https://www.dhsprogram.com/topics/wealth-index/Wealth-Index-Construction.cfm">DHS webpage on wealth index construction</a> provides valuable supplementary information, including the SPSS code for the PCA analysis and the PCA loadings for each variable in the wealth index calculation. These loadings are helpful for validating our own calculations.</p>
</section>
<section id="challenges-and-approach" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="challenges-and-approach"><span class="header-section-number">5.3</span> Challenges and approach</h2>
<p>For <strong>DHS 1997 and DHS 2008</strong>, we aim to replicate the wealth index factor scores using the PCA methodology. To this end, we obtained the SPSS code used by DHS for constructing the wealth index. This code was adapted into R to align with current software practices and allow flexibility in modifying the process for rural-focused studies. However, the SPSS code was not fully explicit, particularly for earlier datasets such as DHS 1997, necessitating careful interpretation and reconstruction of the recoding operations.</p>
</section>
<section id="methods" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="methods"><span class="header-section-number">5.4</span> Methods</h2>
<p>We perform two things :</p>
<ol type="1">
<li>Validate our method by reproducing the variable already included in the datasets: HV270, HV271, HV270a, and HV271a for 2021, and HV270, HV271 for 2008</li>
<li>Extending this approach to produce the variables that are missing in the datasets: HV270A HV271A for 2008, and HV270, HV271, HV270a, and HV271a for 1997</li>
</ol>
<p>To do so, for each survey, we:</p>
<ol type="1">
<li>Study the SPSS programs and documentation provided by the DHS program;</li>
<li>Extract and recode the corresponding variables as similarly as possible that in DHS recipes;</li>
<li>Compute the PCA with the same variables;</li>
<li>Compare the variable loadings with the ones provided by the DHS program;</li>
<li>Compare the household wealth index scores that we calculated with the ones included in the DHS dataset when the latter are available. The comparison is performed through plots and by calculating correslation scores;</li>
<li>Export the scores that we calculated and that were missing in the provided DHS datasets for further use in a related study.</li>
</ol>
<p>All the analysis are performed with R and appropriate libraries to process data <span class="citation" data-cites="tidyverse">(<a href="10-references.html#ref-tidyverse" role="doc-biblioref"><strong>tidyverse?</strong></a>)</span>, handle spss datasets <span class="citation" data-cites="haven">(<a href="10-references.html#ref-haven" role="doc-biblioref"><strong>haven?</strong></a>)</span>, managed labelled variables and values <span class="citation" data-cites="labelled">(<a href="10-references.html#ref-labelled" role="doc-biblioref"><strong>labelled?</strong></a>)</span>, and perform PCA <span class="citation" data-cites="psych">(<a href="10-references.html#ref-psych" role="doc-biblioref"><strong>psych?</strong></a>)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="reproducing-dhs-2021" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="reproducing-dhs-2021"><span class="header-section-number">5.5</span> Reproducing DHS 2021</h2>
<p>We begin this process with the DHS 2021 survey, for which both national and domain-specific wealth indexes (HV270, HV271, HV270A, HV271A) are available. This allows us to validate our approach by comparing reconstructed scores and loadings with those provided by DHS, before extending the methodology to earlier years</p>
<p>We begin by loading the household dataset for DHS 2021 and construct a dictionary of variables to assist with recoding. To replicate the DHS wealth index, we reproduce the transformations applied in the original SPSS script by defining helper functions to dichotomize categorical variables, handle shared sanitation facilities, categorize livestock ownership, and recode ownership of household and personal assets. These operations result in a harmonized dataset containing the same variables used in DHS’s PCA. Additional household characteristics—such as domestic worker presence and home ownership—are retrieved from the individual and men’s questionnaires and merged at the household level. Finally, we extract from the original DHS SPSS syntax the list of variables used in the PCA and remove those with zero variance before computing the first principal component, which serves as our proxy for the wealth index factor score.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data and build a dictionnary -----------------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load DHS 2021 Data</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>hh_2021 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/raw/dhs/DHS_2021/MDHR81DT/MDHR81FL.DTA"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter valid households</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>hh_2021 <span class="ot">&lt;-</span> hh_2021 <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hv015 <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a variable dictionnary</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>cb_hh_2021 <span class="ot">&lt;-</span> hh_2021 <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">look_for</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function ---------------------------------------------------------</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function to dichotomize categorical variables</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>dichotomize <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, condition, new_var, new_var_label) {</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>({{ new_var }} <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>({{ condition }}, <span class="dv">1</span>, <span class="dv">0</span>, <span class="at">missing =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    labelled<span class="sc">::</span><span class="fu">set_variable_labels</span>(<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">ensym</span>(new_var) <span class="sc">:</span><span class="er">=</span> new_var_label) <span class="sc">%&gt;%</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    labelled<span class="sc">::</span><span class="fu">set_value_labels</span>(<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">ensym</span>(new_var) <span class="sc">:</span><span class="er">=</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function that will reclassify if the toilet are shared</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>shared_fac <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, new_var, new_var_label) {</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>      {{ new_var }} <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(hv225 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> {{ var }} <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="at">missing =</span> <span class="dv">0</span>),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      {{ var }} <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(hv225 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, {{ var }}, <span class="at">missing =</span> <span class="dv">0</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    labelled<span class="sc">::</span><span class="fu">set_variable_labels</span>(<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">ensym</span>(new_var) <span class="sc">:</span><span class="er">=</span> new_var_label) <span class="sc">%&gt;%</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    labelled<span class="sc">::</span><span class="fu">set_value_labels</span>(<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">ensym</span>(new_var) <span class="sc">:</span><span class="er">=</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="dv">1</span>))</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to categorize livestock counts</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>categorize_livestock <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, prefix, category_ranges, category_labels) {</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure missing values and conditions are applied first</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      {{ var }} <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>({{ var }}) <span class="sc">|</span> hv246 <span class="sc">!=</span> <span class="dv">1</span>, <span class="dv">0</span>, {{ var }})</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create categorized dummy variables with the given prefix</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(category_ranges)) {</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    new_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prefix, <span class="st">"_"</span>, i)  <span class="co"># Custom prefix for output variable names</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    label <span class="ot">&lt;-</span> category_labels[i]</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!!</span><span class="fu">sym</span>(new_var) <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>({{ var }} <span class="sc">&gt;=</span> category_ranges[[i]][<span class="dv">1</span>] <span class="sc">&amp;</span> {{ var }} <span class="sc">&lt;=</span> category_ranges[[i]][<span class="dv">2</span>])</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_variable_labels</span>(<span class="sc">!!</span><span class="fu">sym</span>(new_var) <span class="sc">:</span><span class="er">=</span> label)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co"># To mimic no2zero in DHS SPSS code (our values are already coded 0 and 1)</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>no2zero <span class="ot">&lt;-</span> <span class="cf">function</span>(data, new_var, old_var, <span class="at">replace_na =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>({{ new_var }} <span class="sc">:</span><span class="er">=</span> {{ old_var }}) <span class="sc">%&gt;%</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>({{ new_var }} <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(replace_na <span class="sc">&amp;</span> <span class="fu">is.na</span>({{ new_var }}), <span class="dv">0</span>, {{ new_var }}))</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Dichotomization as per SPSS original script</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="co"># I rename the outputs to have the same as in: </span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.dhsprogram.com/programming/wealth%20index/Madagascar%20DHS%202021/Madagascar%20DHS%202021.sps.txt</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> hh_2021 <span class="sc">%&gt;%</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Source of drinking water</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">11</span>, QH101_11, <span class="st">"Source of drinking water: Eau du robinet dans le logement"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">12</span>, QH101_12, <span class="st">"Source of drinking water: Eau du robinet dans la cour/Parcelle"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">13</span>, QH101_13, <span class="st">"Source of drinking water: Eau du robinet du voisin"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">14</span>, QH101_14, <span class="st">"Source of drinking water: Eau du robinet public/Borne fontaine"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">21</span>, QH101_21, <span class="st">"Source of drinking water: Puits à pompe ou forage"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">31</span>, QH101_31, <span class="st">"Source of drinking water: Puits creusés protégés"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">32</span>, QH101_32, <span class="st">"Source of drinking water: Puits creusés non protégés"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">41</span>, QH101_41, <span class="st">"Source of drinking water: Source protégée"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">42</span>, QH101_42, <span class="st">"Source of drinking water: Source non protégée"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">51</span>, QH101_51, <span class="st">"Source of drinking water: Eau de pluie"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">61</span>, QH101_61, <span class="st">"Source of drinking water: Camion citerne"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">62</span>, QH101_71, <span class="st">"Source of drinking water: Charette avec petite citerne/tonneau"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">43</span>, QH101_81, <span class="st">"Source of drinking water: Eau de surface/Rivière/Barrage/Lac/Mare/Canal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">71</span>, QH101_91, <span class="st">"Source of drinking water: Eau en bouteille"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv201, hv201 <span class="sc">==</span> <span class="dv">96</span>, QH101_96, <span class="st">"Source of drinking water: Autre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Qui va chercher l'eau?</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv236, hv236 <span class="sc">==</span> <span class="dv">1</span>, QH104A_1, <span class="st">"Qui va chercher l'eau: Femme adulte (&gt;=15 ans)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv236, hv236 <span class="sc">==</span> <span class="dv">2</span>, QH104A_2, <span class="st">"Qui va chercher l'eau: Homme adulte (&gt;=15 ans)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv236, hv236 <span class="sc">==</span> <span class="dv">3</span>, QH104A_3, <span class="st">"Qui va chercher l'eau: Fille (&lt;15 ans)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv236, hv236 <span class="sc">==</span> <span class="dv">4</span>, QH104A_4, <span class="st">"Qui va chercher l'eau: Garçons (&lt;15 ans)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Type of toilet facility</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">11</span>, QH109_11, <span class="st">"Type of toilet facility: Chasse d'eau - à un système d'égout"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">12</span>, QH109_12, <span class="st">"Type of toilet facility: Chasse d'eau - à une fosse septique"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">13</span>, QH109_13, <span class="st">"Type of toilet facility: Chasse d'eau - fosse d'aisance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">14</span>, QH109_14, <span class="st">"Type of toilet facility: Chasse d'eau - à quelque chose d'autre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">15</span>, QH109_15, <span class="st">"Type of toilet facility: Chasse d'eau - ne sait pas"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">21</span>, QH109_21, <span class="st">"Type of toilet facility: Fosses/latrines - ventilées améliorées (VIP)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">22</span>, QH109_22, <span class="st">"Type of toilet facility: Fosses/latrines - avec dalles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">23</span>, QH109_23, <span class="st">"Type of toilet facility: Fosses/latrines - sans dalles/trou ouvert"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">41</span>, QH109_31, <span class="st">"Type of toilet facility: Toilettes à compostage"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">42</span>, QH109_41, <span class="st">"Type of toilet facility: Seau/tinette"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">43</span>, QH109_51, <span class="st">"Type of toilet facility: Toilettes /latrines suspendues"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">31</span>, QH109_61, <span class="st">"Type of toilet facility: Pas de toilette/nature"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv205, hv205 <span class="sc">==</span> <span class="dv">96</span>, QH109_96, <span class="st">"Type of toilet facility: Autre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create shared toilet facility indicators</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_11, QH109_11_sh, <span class="st">"Type of toilet facility: Chasse d'eau - à un système d'égout - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_12, QH109_12_sh, <span class="st">"Type of toilet facility: Chasse d'eau - à une fosse septique - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_13, QH109_13_sh, <span class="st">"Type of toilet facility: Chasse d'eau - fosse d'aisance - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_14, QH109_14_sh, <span class="st">"Type of toilet facility: Chasse d'eau - à quelque chose d'autre - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_15, QH109_15_sh, <span class="st">"Type of toilet facility: Chasse d'eau - ne sait pas - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_21, QH109_21_sh, <span class="st">"Type of toilet facility: Fosses/latrines - ventilées ameliorées (VIP) - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_22, QH109_22_sh, <span class="st">"Type of toilet facility: Fosses/latrines - avec dalles - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_23, QH109_23_sh, <span class="st">"Type of toilet facility: Fosses/latrines - sans dalles/trou ouvert - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_31, QH109_31_sh, <span class="st">"Type of toilet facility: Toilettes à compostage - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_41, QH109_41_sh, <span class="st">"Type of toilet facility: Seau/tinette - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_51, QH109_51_sh, <span class="st">"Type of toilet facility: Toilettes /latrines suspendues - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shared_fac</span>(QH109_96, QH109_96_sh, <span class="st">"Type of toilet facility: Autre - shared"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Type of cooking fuel </span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">1</span>, QH113_1, <span class="st">"Type of cooking fuel: Electricité"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">2</span>, QH113_2, <span class="st">"Type of cooking fuel: Gaz propane liquifié (GPL)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">3</span>, QH113_3, <span class="st">"Type of cooking fuel: Gaz naturel"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">4</span>, QH113_4, <span class="st">"Type of cooking fuel: Biogaz"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">5</span>, QH113_5, <span class="st">"Type of cooking fuel: Kérosène/Petrole"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">6</span>, QH113_6, <span class="st">"Type of cooking fuel: Charbon, lignite"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">7</span>, QH113_7, <span class="st">"Type of cooking fuel: Charbon de bois"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">8</span>, QH113_8, <span class="st">"Type of cooking fuel: Bois"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">9</span>, QH113_9, <span class="st">"Type of cooking fuel: Paille/Branche/Herbes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">10</span>, QH113_10, <span class="st">"Type of cooking fuel: Résidus agricoles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The commented-out SPSS variable (hv226=11) is skipped</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">95</span>, QH113_95, <span class="st">"Type of cooking fuel: Pas de repas préparé dans le ménage"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv226, hv226 <span class="sc">==</span> <span class="dv">11</span> <span class="sc">|</span> hv226 <span class="sc">==</span> <span class="dv">96</span>, QH113_96, <span class="st">"Type of cooking fuel: Autre/Bouse"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cows/bulls</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246b, <span class="st">"QH118A"</span>,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">98</span>)), </span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Cows/bulls: 1-4"</span>, <span class="st">"Cows/bulls: 5-9"</span>, <span class="st">"Cows/bulls: 10+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zébus</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246g, <span class="st">"QH118B"</span>,</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">98</span>)), </span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Zébus: 1-4"</span>, <span class="st">"Zébus: 5-9"</span>, <span class="st">"Zébus: 10+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Horses/donkeys/mules</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246c, <span class="st">"QH118C"</span>, </span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">98</span>)), </span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Horses/donkeys/mules: 1-4"</span>, <span class="st">"Horses/donkeys/mules: 5-9"</span>, <span class="st">"Horses/donkeys/mules: 10+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Goats</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246d, <span class="st">"QH118D"</span>,</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">98</span>)), </span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Goats: 1-4"</span>, <span class="st">"Goats: 5-9"</span>, <span class="st">"Goats: 10+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sheep</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246e, <span class="st">"QH118E"</span>,</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">98</span>)), </span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Sheep: 1-4"</span>, <span class="st">"Sheep: 5-9"</span>, <span class="st">"Sheep: 10+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Chickens/poultry (different range)</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246f, <span class="st">"QH118F"</span>, </span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">29</span>), <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">98</span>)), </span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Chickens or other poultry: 1-9"</span>, <span class="st">"Chickens or other poultry: 10-29"</span>, <span class="st">"Chickens or other poultry: 30+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ducks/geese/turkeys</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246h, <span class="st">"QH118G"</span>, </span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">98</span>)), </span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Canards/Oies/Dindes: 1-4"</span>, <span class="st">"Canards/Oies/Dindes: 5-9"</span>, <span class="st">"Canards/Oies/Dindes: 10+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pigs</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">categorize_livestock</span>(hv246i, <span class="st">"QH118H"</span>, </span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">98</span>)), </span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"Cochons: 1-4"</span>, <span class="st">"Cochons: 5-9"</span>, <span class="st">"Cochons: 10+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define land area</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">landarea =</span> hv245,  <span class="co"># Assign hv245 to landarea</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">landarea =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(hv245) <span class="sc">|</span> hv245 <span class="sc">&gt;=</span> <span class="fl">99.8</span>, <span class="fl">99.9</span>, landarea),  <span class="co"># Set to 99.9 if missing or &gt;= 99.8</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">landarea =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(hv244) <span class="sc">|</span> hv244 <span class="sc">!=</span> <span class="dv">1</span>, <span class="dv">0</span>, landarea)  <span class="co"># Set to 0 if QH119 is missing or not 1</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Household assets</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121A, hv206) <span class="sc">%&gt;%</span>   <span class="co"># Electricity</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121B, hv207) <span class="sc">%&gt;%</span>   <span class="co"># Radio</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121C, hv208) <span class="sc">%&gt;%</span>   <span class="co"># Television</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121D, hv221) <span class="sc">%&gt;%</span>   <span class="co"># Telephone (non-mobile)</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121E, hv243e) <span class="sc">%&gt;%</span>  <span class="co"># Computer</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121F, hv209) <span class="sc">%&gt;%</span>   <span class="co"># Refrigerator</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121G, sh121g) <span class="sc">%&gt;%</span>  <span class="co"># Bed</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121H, sh121h) <span class="sc">%&gt;%</span>  <span class="co"># Table</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121I, sh121i) <span class="sc">%&gt;%</span>  <span class="co"># Chair</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121J, sh121j) <span class="sc">%&gt;%</span>  <span class="co"># Sofa</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121K, sh121k) <span class="sc">%&gt;%</span>  <span class="co"># Sewing machine</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121L, sh121l) <span class="sc">%&gt;%</span>  <span class="co"># Fan</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121M, sh121m) <span class="sc">%&gt;%</span>  <span class="co"># DVD player</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH121N, sh121n) <span class="sc">%&gt;%</span>  <span class="co"># Water heater</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Personal assets</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH122A, hv243b) <span class="sc">%&gt;%</span> <span class="co"># Watch</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH122B, hv243a) <span class="sc">%&gt;%</span> <span class="co"># Mobile phone</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH122C, hv210) <span class="sc">%&gt;%</span>  <span class="co"># Bicycle</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH122D, hv211) <span class="sc">%&gt;%</span>  <span class="co"># Motorcycle or scooter</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH122E, hv243c) <span class="sc">%&gt;%</span> <span class="co"># Animal drawn cart</span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH122F, hv212) <span class="sc">%&gt;%</span>  <span class="co"># Car or truck</span></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH122G, hv243d) <span class="sc">%&gt;%</span> <span class="co"># Boat with motor</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Financial acces</span></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(QH123, hv247) <span class="sc">%&gt;%</span>   <span class="co"># Has a bank account</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Main floor material</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">11</span>, QH142_11, <span class="st">"Main floor material: Terre/sable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">12</span>, QH142_12, <span class="st">"Main floor material: Bouse"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">21</span>, QH142_21, <span class="st">"Main floor material: Planches en bois"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">22</span>, QH142_22, <span class="st">"Main floor material: Palmes/bambou"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">23</span>, QH142_23, <span class="st">"Main floor material: Nattes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">31</span>, QH142_31, <span class="st">"Main floor material: Parquet ou bois ciré"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">32</span>, QH142_32, <span class="st">"Main floor material: Bandes de vinyles/asphalte"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">33</span>, QH142_33, <span class="st">"Main floor material: Carrelage"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">34</span>, QH142_34, <span class="st">"Main floor material: Ciment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">35</span>, QH142_35, <span class="st">"Main floor material: Moquette"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv213, hv213 <span class="sc">==</span> <span class="dv">96</span>, QH142_96, <span class="st">"Main floor material: Autre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Main roof material</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">11</span>, QH143_11, <span class="st">"Main roof material: Pas de toit"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">12</span>, QH143_12, <span class="st">"Main roof material: Chaume/feuilles/herbes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">13</span>, QH143_13, <span class="st">"Main roof material: Mottes de terre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">21</span>, QH143_21, <span class="st">"Main roof material: Natte"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">22</span>, QH143_22, <span class="st">"Main roof material: Palme/bambou"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">23</span>, QH143_23, <span class="st">"Main roof material: Planches en bois"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">24</span>, QH143_24, <span class="st">"Main roof material: Carton"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">31</span>, QH143_31, <span class="st">"Main roof material: Tôle"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">32</span>, QH143_32, <span class="st">"Main roof material: Bois"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">33</span>, QH143_33, <span class="st">"Main roof material: Zinc/fibre de ciment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">34</span>, QH143_34, <span class="st">"Main roof material: Tuiles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">35</span>, QH143_35, <span class="st">"Main roof material: Ciment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">36</span>, QH143_36, <span class="st">"Main roof material: Shingles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv215, hv215 <span class="sc">==</span> <span class="dv">96</span>, QH143_96, <span class="st">"Main roof material: Autre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Main wall material</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">11</span>, QH144_11, <span class="st">"Main wall material: Pas de mur"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">12</span>, QH144_12, <span class="st">"Main wall material: Bambou/Cane/Palme/Tronc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">13</span>, QH144_13, <span class="st">"Main wall material: Terre"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">21</span>, QH144_21, <span class="st">"Main wall material: Bambou avec boue"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">22</span>, QH144_22, <span class="st">"Main wall material: Pierres avec boue"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">23</span>, QH144_23, <span class="st">"Main wall material: Adobe non recouvert"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">24</span>, QH144_24, <span class="st">"Main wall material: Contre-Plaque"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">25</span>, QH144_25, <span class="st">"Main wall material: Carton"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">26</span>, QH144_26, <span class="st">"Main wall material: Bois de récupération"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">31</span>, QH144_31, <span class="st">"Main wall material: Ciment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">32</span>, QH144_32, <span class="st">"Main wall material: Pierres avec chaux/ciment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">33</span>, QH144_33, <span class="st">"Main wall material: Briques"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">34</span>, QH144_34, <span class="st">"Main wall material: Blocs de ciment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">35</span>, QH144_35, <span class="st">"Main wall material: Adobe recouvert"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">36</span>, QH144_36, <span class="st">"Main wall material: Planches en bois/Shingles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">37</span>, QH144_37, <span class="st">"Main wall material: Tôle"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dichotomize</span>(hv214, hv214 <span class="sc">==</span> <span class="dv">96</span>, QH144_96, <span class="st">"Main wall material: Autres"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Members sleeping</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">hv216 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(hv216) <span class="sc">|</span> hv216 <span class="sc">==</span> <span class="dv">0</span>, hv012, hv216),  <span class="co"># Replace hv216 if 0 or NA with hv012</span></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsleep =</span> <span class="fu">trunc</span>(hv012 <span class="sc">/</span> hv216),  <span class="co"># Ensure integer values</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsleep =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(hv216) <span class="sc">|</span> hv216 <span class="sc">&gt;=</span> <span class="dv">99</span> <span class="sc">|</span> memsleep <span class="sc">&gt;=</span> <span class="dv">98</span>, <span class="cn">NA_real_</span>, memsleep)  <span class="co"># Assign NA instead of 99</span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_variable_labels</span>(<span class="at">memsleep =</span> <span class="st">"Number of members per sleeping room"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set rural / urban</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>    <span class="at">urban =</span> <span class="fu">as.integer</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>),  <span class="co"># Urban is 1 if hv025 == 1, else 0</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">rural =</span> <span class="fu">as.integer</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>)   <span class="co"># Rural is 1 if hv025 == 2, else 0</span></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recoding of 3 variables is not documented in DHS SPSS example, although they are used in the PCA</span></span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">no2zero</span>(LAND, hv244) <span class="co"># Owns land</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data for missing variables -----------------------------------------</span></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="co"># Some variables are built with other sources than Housheold</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a><span class="co"># We look in the individual recode</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>ir_2021 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/raw/dhs/DHS_2021/MDIR81DT/MDIR81FL.DTA"</span>)</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a variable dictionnary</span></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>cb_ir_2021 <span class="ot">&lt;-</span> ir_2021 <span class="sc">|&gt;</span> </span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">look_for</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a><span class="co"># We look in the men recode</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>mr_2021 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/raw/dhs/DHS_2021/MDMR81DT/MDMR81FL.DTA"</span>)</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>cb_mr_2021 <span class="ot">&lt;-</span> mr_2021 <span class="sc">|&gt;</span> </span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">look_for</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute DOMESTIC --------------------------------------------------------</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a><span class="co"># Possible alternative:  v716 (husband/partner's occupation) == 91 (housekeeper)</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>domestic_ir <span class="ot">&lt;-</span> ir_2021 <span class="sc">%&gt;%</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(v150 <span class="sc">==</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span>  <span class="co"># Ensure not related to household head</span></span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(v001, v002) <span class="sc">%&gt;%</span></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">DOMESTIC_IR =</span> <span class="fu">as.integer</span>(<span class="fu">any</span>(v717 <span class="sc">==</span> <span class="dv">6</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>domestic_mr <span class="ot">&lt;-</span> mr_2021 <span class="sc">%&gt;%</span></span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mv150 <span class="sc">==</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span>  <span class="co"># Ensure not related to household head</span></span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mv001, mv002) <span class="sc">%&gt;%</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">DOMESTIC_MR =</span> <span class="fu">as.integer</span>(<span class="fu">any</span>(mv717 <span class="sc">==</span> <span class="dv">6</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DOMESTIC =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(domestic_ir, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hv001"</span> <span class="ot">=</span> <span class="st">"v001"</span>, <span class="st">"hv002"</span> <span class="ot">=</span> <span class="st">"v002"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(domestic_mr, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hv001"</span> <span class="ot">=</span> <span class="st">"mv001"</span>, <span class="st">"hv002"</span> <span class="ot">=</span> <span class="st">"mv002"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">DOMESTIC =</span> <span class="fu">if_else</span>(<span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="fu">starts_with</span>(<span class="st">"DOMESTIC_"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"DOMESTIC_"</span>))</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a><span class="co"># mean(test2$DOMESTIC, na.rm = TRUE)</span></span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 0.007947343</span></span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.00 reported in DHS excel table</span></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute HOUSE -----------------------------------------------------------</span></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>house_own_ir <span class="ot">&lt;-</span> ir_2021 <span class="sc">%&gt;%</span></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(v001, v002) <span class="sc">%&gt;%</span>  <span class="co"># Group by household number</span></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">HOUSE_IR =</span> <span class="fu">as.integer</span>(<span class="fu">any</span>(v745a <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))  <span class="co"># If any member owns a house, set HOUSE = 1</span></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>house_own_mr <span class="ot">&lt;-</span> mr_2021 <span class="sc">%&gt;%</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mv001, mv002) <span class="sc">%&gt;%</span>  <span class="co"># Group by household number</span></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">HOUSE_MR =</span> <span class="fu">as.integer</span>(<span class="fu">any</span>(mv745a <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))  <span class="co"># If any member owns a house, set HOUSE = 1</span></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>test3 <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(house_own_ir , <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hv001"</span> <span class="ot">=</span> <span class="st">"v001"</span>, <span class="st">"hv002"</span> <span class="ot">=</span> <span class="st">"v002"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(house_own_mr , <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hv001"</span> <span class="ot">=</span> <span class="st">"mv001"</span>, <span class="st">"hv002"</span> <span class="ot">=</span> <span class="st">"mv002"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>    <span class="at">HOUSE =</span> <span class="fu">if_else</span>(<span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="fu">starts_with</span>(<span class="st">"HOUSE_"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"HOUSE_"</span>))</span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a><span class="co"># mean(test3$HOUSE)</span></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 0.5293515</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a><span class="co"># MEan reported in DHS : 0.54</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute PCA -------------------------------------------------------------</span></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a><span class="co"># A function to extract variable names from SPSS code provided by DHS</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>extract_variable_names <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path, line_range) {</span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_lines</span>(file_path) <span class="sc">%&gt;%</span>                <span class="co"># Read the entire file</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>    .[line_range[<span class="dv">1</span>]<span class="sc">:</span>line_range[<span class="dv">2</span>]] <span class="sc">%&gt;%</span>     <span class="co"># Extract the specified line range</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span>              <span class="co"># Concatenate lines into a single string</span></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">%&gt;%</span>                   <span class="co"># Split by whitespace</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span>                            <span class="co"># Convert list to a character vector</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>    <span class="fu">discard</span>(<span class="sc">~</span> .x <span class="sc">==</span> <span class="st">""</span>)                     <span class="co"># Remove empty elements</span></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a><span class="co"># file path of the source file</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>dhs_spss_path <span class="ot">&lt;-</span> <span class="st">"data/raw/dhs/DHS_wealth_index/Madagascar DHS 2021.sps.txt"</span></span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a><span class="co"># variables listed in the PCA labeled "Test", from line 366 to 378</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>test_pca_vars <span class="ot">&lt;-</span> <span class="fu">extract_variable_names</span>(dhs_spss_path, <span class="fu">c</span>(<span class="dv">366</span>, <span class="dv">378</span>))</span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>common_pca_vars <span class="ot">&lt;-</span> <span class="fu">extract_variable_names</span>(dhs_spss_path, <span class="fu">c</span>(<span class="dv">407</span>, <span class="dv">415</span>))</span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>urban_pca_vars <span class="ot">&lt;-</span> <span class="fu">extract_variable_names</span>(dhs_spss_path, <span class="fu">c</span>(<span class="dv">445</span>, <span class="dv">457</span>))</span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>rural_pca_vars <span class="ot">&lt;-</span> <span class="fu">extract_variable_names</span>(dhs_spss_path, <span class="fu">c</span>(<span class="dv">487</span>, <span class="dv">499</span>))</span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>hh_2021_rec <span class="ot">&lt;-</span> test3 <span class="sc">%&gt;%</span></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(common_pca_vars), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">replace_na</span>(., <span class="dv">0</span>))))</span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove zero-variance variables</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>zero_var_cols <span class="ot">&lt;-</span> hh_2021_rec <span class="sc">%&gt;%</span></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(common_pca_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">var</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variance <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(variable)</span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>common_pca_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(common_pca_vars, zero_var_cols)  <span class="co"># Exclude those variables</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a><span class="co"># Run PCA only on valid variables</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>pca_result_2021 <span class="ot">&lt;-</span> <span class="fu">principal</span>(</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(common_pca_vars)), <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>), </span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfactors =</span> <span class="dv">1</span>, <span class="at">rotate =</span> <span class="st">"none"</span>, <span class="at">scores =</span> <span class="cn">TRUE</span>, <span class="at">covar =</span> <span class="cn">FALSE</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We first evaluate our ability to replicate the national wealth index (<code>hv271</code>) using a single, national-level PCA. We compare the component score coefficients published by DHS in their accompanying Excel file with the loadings obtained from our PCA on harmonized variables. This allows us to visually and statistically assess the consistency of our implementation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="st">"data/raw/dhs/DHS_wealth_index/Madagascar DHS 2021_simplified.xlsx"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the DHS PCA coefficients</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>common_pca <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path, <span class="at">sheet =</span> <span class="st">"Common"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variable names and descriptions</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>common_pca_clean <span class="ot">&lt;-</span> common_pca <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">str_extract</span>(<span class="st">`</span><span class="at">Component Score Coefficient Matrix</span><span class="st">`</span>, <span class="st">"^[^ ]+"</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Component Score Coefficient Matrix</span><span class="st">`</span>, <span class="st">"^[^ ]+ "</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract loadings from our R PCA</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>r_pca_loadings <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">rownames</span>(pca_result_2021<span class="sc">$</span>loadings),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">r_pca_loading =</span> pca_result_2021<span class="sc">$</span>loadings[, <span class="dv">1</span>]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge and compare</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> common_pca_clean <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(r_pca_loadings, <span class="at">by =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(variable, description, <span class="st">`</span><span class="at">DHS Factor Score</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Component</span><span class="st">`</span>, r_pca_loading)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the match between DHS and reproduced PCA loadings</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">DHS Factor Score</span><span class="st">`</span>), <span class="at">y =</span> r_pca_loading)) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"DHS Loadings vs. PCA Loadings"</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"DHS Factor Loadings"</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Reproduced PCA Loadings"</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03-wealth-index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between published and reproduced PCA loadings</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(<span class="fu">as.numeric</span>(comparison<span class="sc">$</span><span class="st">`</span><span class="at">DHS Factor Score</span><span class="st">`</span>), comparison<span class="sc">$</span>r_pca_loading)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  as.numeric(comparison$`DHS Factor Score`) and comparison$r_pca_loading
t = 191.43, df = 118, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.9976931 0.9988818
sample estimates:
      cor 
0.9983938 </code></pre>
</div>
</div>
<p>The plot and correlation results strongly support the accuracy of our implementation of the national PCA. The scatterplot shows an almost perfect linear alignment between the DHS-provided factor loadings and those we reproduced using the harmonized dataset. This is confirmed statistically by a Pearson correlation coefficient of 0.998, with a p-value &lt; 2.2e-16, indicating an extremely high degree of agreement between the two sets of loadings. This near-perfect correlation suggests that our harmonization and PCA procedure closely replicates the methodology applied by DHS for constructing the national wealth index (<code>hv271</code>).</p>
<p>We then compute a household-level wealth score using this national PCA and compare it to the hv271 variable in the DHS dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute factor scores using national PCA</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>hh_2021_rec <span class="ot">&lt;-</span> hh_2021_rec <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">factor_score =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(common_pca_vars))) <span class="sc">%*%</span> pca_result_2021<span class="sc">$</span>loadings[, <span class="dv">1</span>]))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot computed vs. official DHS national score</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_2021_rec, <span class="fu">aes</span>(<span class="at">x =</span> hv271, <span class="at">y =</span> factor_score, <span class="at">color =</span> <span class="fu">as.factor</span>(hv025))) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"hv271 vs Reproduced National Wealth Index"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"hv271 (Official National Wealth Score)"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Computed National Factor Score"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03-wealth-index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spearman correlation between computed and official national score</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(hh_2021_rec<span class="sc">$</span>hv271, hh_2021_rec<span class="sc">$</span>factor_score, <span class="at">method =</span> <span class="st">"spearman"</span>, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9939895</code></pre>
</div>
</div>
<p>The comparison between the official national wealth index (hv271) and our reconstructed factor score shows a strong positive association, both visually and statistically. The scatterplot indicates that the rank ordering of households is closely preserved, and the Spearman correlation coefficient of 0.994 suggests a very high level of concordance. While some minor deviations are visible—particularly at the distribution tails—these results support the conclusion that our implementation provides a reliable approximation of the national wealth index, suitable for rank-based analyses such as centile classification.</p>
<p>We now turn to the domain-specific PCA, in which we compute wealth scores separately for urban and rural households. This mirrors the DHS method used to construct the hv271a variable. We estimate the domain-specific PCA on each subsample, predict scores, and assess the correspondence with hv271a.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recompute dataset (replace NAs with 0)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>hh_2021_rec <span class="ot">&lt;-</span> test3 <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(common_pca_vars), <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">replace_na</span>(., <span class="dv">0</span>))))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter variables with variance</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>remove_zero_var <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var_list) {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  zero_var_cols <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(var_list)) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(variance <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(variable)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setdiff</span>(var_list, zero_var_cols)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>urban_pca_vars <span class="ot">&lt;-</span> <span class="fu">remove_zero_var</span>(hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>), </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                                  urban_pca_vars)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>rural_pca_vars <span class="ot">&lt;-</span> <span class="fu">remove_zero_var</span>(hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>), </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                                  rural_pca_vars)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA for urban and rural</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>pca_urban <span class="ot">&lt;-</span> <span class="fu">principal</span>(<span class="fu">cor</span>(hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">select</span>(<span class="fu">all_of</span>(urban_pca_vars)), </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nfactors =</span> <span class="dv">1</span>, <span class="at">rotate =</span> <span class="st">"none"</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>pca_rural <span class="ot">&lt;-</span> <span class="fu">principal</span>(<span class="fu">cor</span>(hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">select</span>(<span class="fu">all_of</span>(rural_pca_vars)), </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>),</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nfactors =</span> <span class="dv">1</span>, <span class="at">rotate =</span> <span class="st">"none"</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scores</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>hh_2021_rec <span class="ot">&lt;-</span> hh_2021_rec <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">urbscore =</span> <span class="fu">if_else</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(urban_pca_vars))) <span class="sc">%*%</span> </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                                   pca_urban<span class="sc">$</span>loadings[, <span class="dv">1</span>]), </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">NA_real_</span>),</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">rurscore =</span> <span class="fu">if_else</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>, </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(rural_pca_vars))) <span class="sc">%*%</span> </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>                                   pca_rural<span class="sc">$</span>loadings[, <span class="dv">1</span>]), </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">NA_real_</span>),</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">domscor =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>      hv025 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> urbscore,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>      hv025 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> rurscore</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We finally compare the domain-specific score (domscor) to hv271a to assess the accuracy of our reconstruction:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot: domscor vs hv271a</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_2021_rec, <span class="fu">aes</span>(<span class="at">x =</span> domscor, <span class="at">y =</span> hv271a)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> hv025, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">hv025 =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Urban"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Rural"</span>))) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Reconstructed Domain-Specific Score vs HV271A"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Computed Domain-Specific Score"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"HV271A (Urban/Rural Wealth Index)"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03-wealth-index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spearman correlations</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>spearman_urban <span class="ot">&lt;-</span> <span class="fu">cor</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(hv271a),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(domscor),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"spearman"</span>, <span class="at">use =</span> <span class="st">"complete.obs"</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>spearman_rural <span class="ot">&lt;-</span> <span class="fu">cor</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(hv271a),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  hh_2021_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(domscor),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"spearman"</span>, <span class="at">use =</span> <span class="st">"complete.obs"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">domain =</span> <span class="fu">c</span>(<span class="st">"Urban"</span>, <span class="st">"Rural"</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">spearman_dom_vs_HV271A =</span> <span class="fu">c</span>(spearman_urban, spearman_rural)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  domain spearman_dom_vs_HV271A
  &lt;chr&gt;                   &lt;dbl&gt;
1 Urban                   0.995
2 Rural                   0.999</code></pre>
</div>
</div>
<p>We then assess the quality of our domain-specific PCA reconstruction by comparing our computed scores to the official DHS variable hv271a, which provides separate wealth indices for urban and rural areas. The scatterplots indicate a strong concordance across both domains, and the Spearman correlation coefficients—0.995 for urban households and 0.999 for rural ones—confirm that our domain-specific factor scores closely replicate the rank ordering captured in hv271a. Although minor non-linearities are visible, particularly in the upper ranges, these results suggest that our approach captures the intended within-domain variation with a high degree of fidelity.</p>
</section>
<section id="extending-dhs-2008" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="extending-dhs-2008"><span class="header-section-number">5.6</span> Extending DHS 2008</h2>
<p>The process involves several steps. First, we recode relevant variables from the DHS household dataset, ensuring that they aligned with the wealth index components, such as water sources, sanitation facilities, and household assets. Missing values were handled in the same way than DHS, by replacing them with either the variable mean for dichotomized variables or zero for animal husbandry-related variables.</p>
<p>Using the recoded data, we computed a correlation matrix for the selected variables and performed PCA to extract the first principal component, representing the wealth index factor. We then calculate factor scores for each household based on the PCA loadings.</p>
<p>Finally, we validated our approach by comparing the PCA loadings attributed to each PCA variable with those provided by DHS. We also compare the reconstructed scores for each household with the official DHS factor scores (hv271). We provide a graphical comparison as well as a correlation test.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load DHS Data (assuming already loaded as hh_2008)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>hh_2008 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/raw/dhs/DHS_2008/MDHR51DT/MDHR51FL.DTA"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter valid households</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>hh_2008 <span class="ot">&lt;-</span> hh_2008 <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hv015 <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>hh_2008_rec <span class="ot">&lt;-</span> hh_2008 <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># water source</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2oires =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2oyard =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2opub =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">13</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2owell =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">21</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2opwell =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">31</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2ouwell =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">32</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2spring =</span> <span class="fu">if_else</span>(hv201 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">41</span>, <span class="dv">42</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2osurf =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">43</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2ooth =</span> <span class="fu">if_else</span>(hv201 <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">&amp;</span> hv201 <span class="sc">&lt;</span> <span class="dv">97</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Toilet types</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">flushp =</span> <span class="fu">if_else</span>((hv205 <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> hv205 <span class="sc">&lt;</span> <span class="dv">15</span>) <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">flushs =</span> <span class="fu">if_else</span>((hv205 <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> hv205 <span class="sc">&lt;</span> <span class="dv">15</span>) <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">latvipp =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">21</span> <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">latvips =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">21</span> <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">latslbp =</span> <span class="fu">if_else</span>(hv205 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">23</span>) <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">latslbs =</span> <span class="fu">if_else</span>(hv205 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">23</span>) <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">latopp =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">24</span> <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">latops =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">24</span> <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">latbush =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">31</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">latothp =</span> <span class="fu">if_else</span>((hv205 <span class="sc">&gt;</span> <span class="dv">40</span> <span class="sc">&amp;</span> hv205 <span class="sc">&lt;</span> <span class="dv">44</span>) <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">latoths =</span> <span class="fu">if_else</span>((hv205 <span class="sc">&gt;</span> <span class="dv">40</span> <span class="sc">&amp;</span> hv205 <span class="sc">&lt;</span> <span class="dv">44</span>) <span class="sc">&amp;</span> hv225 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Amenities</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">electric =</span> <span class="fu">if_else</span>(hv206 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">radio =</span> <span class="fu">if_else</span>(hv207 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">tv =</span> <span class="fu">if_else</span>(hv208 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">fridge =</span> <span class="fu">if_else</span>(hv209 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">bicycle =</span> <span class="fu">if_else</span>(hv210 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">motobk =</span> <span class="fu">if_else</span>(hv211 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">car =</span> <span class="fu">if_else</span>(hv212 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">mphone =</span> <span class="fu">if_else</span>(hv243a <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">watch =</span> <span class="fu">if_else</span>(hv243b <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">bank =</span> <span class="fu">if_else</span>(hv247 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># floor type variables</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">dirtfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">plnkfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">21</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">palmfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">22</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">matfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">96</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">parqfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">31</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">vinfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">32</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">tilefloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">33</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">cemtfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">34</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">carpfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">35</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cooking fuel</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">cookelec =</span> <span class="fu">if_else</span>(hv226 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">cooklpg =</span> <span class="fu">if_else</span>(hv226 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">cookcoal =</span> <span class="fu">if_else</span>(hv226 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">cookwood =</span> <span class="fu">if_else</span>(hv226 <span class="sc">==</span> <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">cookstrw =</span> <span class="fu">if_else</span>(hv226 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">cooknone =</span> <span class="fu">if_else</span>(hv226 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">95</span>, <span class="dv">96</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">#wall materials</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">grnwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">==</span> <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">dirtwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">13</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">bamwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">22</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwdwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">26</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">cmtwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">==</span> <span class="dv">31</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">stncwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">==</span> <span class="dv">32</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">brckwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">==</span> <span class="dv">33</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">blckwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">==</span> <span class="dv">34</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">woodwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">==</span> <span class="dv">36</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">othwall =</span> <span class="fu">if_else</span>(hv214 <span class="sc">==</span> <span class="dv">96</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># roofing materials</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">natroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">sodroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">==</span> <span class="dv">13</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">rudroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">plnkroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">==</span> <span class="dv">23</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">ironroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">95</span>, <span class="dv">96</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">woodroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">==</span> <span class="dv">32</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">cemtroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">35</span>, <span class="dv">36</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">tileroof =</span> <span class="fu">if_else</span>(hv215 <span class="sc">==</span> <span class="dv">34</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle missing values for hv216 and compute members per sleeping room</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">hv216 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(hv216)<span class="sc">|</span>hv216 <span class="sc">==</span> <span class="dv">0</span>, hv012, hv216),</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsleep =</span> hv012 <span class="sc">/</span> hv216,</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pondération</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">hhmemwt =</span> hv005 <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">*</span> hv012,</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">wt =</span> hv005 <span class="sc">/</span> <span class="dv">1000000</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Store variable names for reuse</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>dich_vars_2008 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2oires"</span>, <span class="st">"h2oyard"</span>, <span class="st">"h2opub"</span>, <span class="st">"h2owell"</span>, <span class="st">"h2opwell"</span>, <span class="st">"h2ouwell"</span>,</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2spring"</span>, <span class="st">"h2osurf"</span>, <span class="st">"h2ooth"</span>, <span class="st">"flushp"</span>, <span class="st">"flushs"</span>, <span class="st">"latvipp"</span>, <span class="st">"latvips"</span>,</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">"latslbp"</span>, <span class="st">"latslbs"</span>, <span class="st">"latopp"</span>, <span class="st">"latops"</span>, <span class="st">"latbush"</span>, <span class="st">"latothp"</span>, <span class="st">"latoths"</span>,</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>  <span class="st">"electric"</span>, <span class="st">"radio"</span>, <span class="st">"tv"</span>, <span class="st">"fridge"</span>, <span class="st">"bicycle"</span>, <span class="st">"motobk"</span>, <span class="st">"car"</span>, <span class="st">"mphone"</span>,</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>  <span class="st">"watch"</span>, <span class="st">"bank"</span>, <span class="st">"memsleep"</span>, <span class="st">"dirtfloo"</span>, <span class="st">"plnkfloo"</span>, <span class="st">"palmfloo"</span>, <span class="st">"matfloo"</span>,</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>  <span class="st">"parqfloo"</span>, <span class="st">"vinfloo"</span>, <span class="st">"tilefloo"</span>, <span class="st">"cemtfloo"</span>, <span class="st">"carpfloo"</span>, <span class="st">"cookelec"</span>,</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cooklpg"</span>, <span class="st">"cookcoal"</span>, <span class="st">"cookwood"</span>, <span class="st">"cookstrw"</span>, <span class="st">"cooknone"</span>, <span class="st">"grnwall"</span>,</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dirtwall"</span>, <span class="st">"bamwall"</span>, <span class="st">"rwdwall"</span>, <span class="st">"cmtwall"</span>, <span class="st">"stncwall"</span>, <span class="st">"brckwall"</span>,</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>  <span class="st">"blckwall"</span>, <span class="st">"woodwall"</span>, <span class="st">"othwall"</span>, <span class="st">"natroof"</span>, <span class="st">"sodroof"</span>, <span class="st">"rudroof"</span>,</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>  <span class="st">"plnkroof"</span>, <span class="st">"ironroof"</span>, <span class="st">"woodroof"</span>, <span class="st">"cemtroof"</span>, <span class="st">"tileroof"</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>animal_husbandry_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">"hv246a"</span>, <span class="st">"hv246b"</span>, <span class="st">"hv246c"</span>, <span class="st">"hv246d"</span>, <span class="st">"hv246e"</span>, <span class="st">"hv246f"</span>, <span class="st">"hv246g"</span>, <span class="st">"hv246h"</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>all_factor_vars_2008 <span class="ot">&lt;-</span> <span class="fu">c</span>(dich_vars_2008 , animal_husbandry_vars)</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>perform_pca <span class="ot">&lt;-</span> <span class="cf">function</span>(data, vars) {</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>  cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(vars)), <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">principal</span>(cor_matrix, <span class="at">nfactors =</span> <span class="dv">1</span>, <span class="at">rotate =</span> <span class="st">"none"</span>, <span class="at">scores =</span> <span class="cn">TRUE</span>, <span class="at">covar =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">perform_pca</span>(hh_2008_rec, <span class="fu">c</span>(dich_vars_2008, animal_husbandry_vars))</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA loadings and compute factor scores</span></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>hh_2008_rec <span class="ot">&lt;-</span> hh_2008_rec <span class="sc">%&gt;%</span></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">factor_score =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(hh_2008_rec <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(dich_vars_2008), <span class="fu">all_of</span>(animal_husbandry_vars))) <span class="sc">%*%</span> pca_result<span class="sc">$</span>loadings[, <span class="dv">1</span>])</span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparison and Visualization</span></span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">paste0</span>(<span class="st">"Var"</span>, <span class="fu">seq_along</span>(pca_result<span class="sc">$</span>loadings[, <span class="dv">1</span>])), <span class="co"># Replace with actual names if needed</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">dhs_factor_score =</span> <span class="fu">c</span>(<span class="fl">0.051</span>, <span class="fl">0.036</span>, <span class="fl">0.044</span>, <span class="fl">0.001</span>, <span class="fl">0.006</span>, <span class="sc">-</span><span class="fl">0.023</span>, <span class="sc">-</span><span class="fl">0.027</span>, <span class="sc">-</span><span class="fl">0.040</span>, <span class="sc">-</span><span class="fl">0.004</span>,</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>                       <span class="fl">0.049</span>, <span class="fl">0.024</span>, <span class="fl">0.005</span>, <span class="fl">0.010</span>, <span class="fl">0.012</span>, <span class="fl">0.018</span>, <span class="fl">0.011</span>, <span class="fl">0.033</span>, <span class="sc">-</span><span class="fl">0.070</span>,</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>                       <span class="fl">0.004</span>, <span class="fl">0.010</span>, <span class="fl">0.096</span>, <span class="fl">0.053</span>, <span class="fl">0.094</span>, <span class="fl">0.060</span>, <span class="fl">0.035</span>, <span class="fl">0.036</span>, <span class="fl">0.047</span>,</span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>                       <span class="fl">0.090</span>, <span class="fl">0.072</span>, <span class="fl">0.067</span>, <span class="sc">-</span><span class="fl">0.035</span>, <span class="sc">-</span><span class="fl">0.022</span>, <span class="fl">0.009</span>, <span class="sc">-</span><span class="fl">0.022</span>, <span class="sc">-</span><span class="fl">0.059</span>,</span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>                       <span class="fl">0.037</span>, <span class="fl">0.004</span>, <span class="fl">0.032</span>, <span class="fl">0.066</span>, <span class="fl">0.007</span>, <span class="fl">0.016</span>, <span class="fl">0.029</span>, <span class="fl">0.084</span>, <span class="sc">-</span><span class="fl">0.088</span>,</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span><span class="fl">0.002</span>, <span class="fl">0.001</span>, <span class="sc">-</span><span class="fl">0.035</span>, <span class="sc">-</span><span class="fl">0.042</span>, <span class="sc">-</span><span class="fl">0.017</span>, <span class="fl">0.006</span>, <span class="fl">0.047</span>, <span class="fl">0.013</span>,</span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>                       <span class="fl">0.054</span>, <span class="fl">0.014</span>, <span class="fl">0.009</span>, <span class="fl">0.008</span>, <span class="sc">-</span><span class="fl">0.047</span>, <span class="sc">-</span><span class="fl">0.043</span>, <span class="sc">-</span><span class="fl">0.008</span>, <span class="sc">-</span><span class="fl">0.007</span>,</span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>                       <span class="fl">0.085</span>, <span class="sc">-</span><span class="fl">0.005</span>, <span class="fl">0.009</span>, <span class="fl">0.017</span>, <span class="sc">-</span><span class="fl">0.017</span>, <span class="sc">-</span><span class="fl">0.004</span>, <span class="fl">0.000</span>, <span class="sc">-</span><span class="fl">0.009</span>,</span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span><span class="fl">0.009</span>, <span class="sc">-</span><span class="fl">0.007</span>, <span class="sc">-</span><span class="fl">0.003</span>, <span class="fl">0.005</span>), <span class="co"># SPSS values</span></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">r_pca_loading =</span> pca_result<span class="sc">$</span>loadings[, <span class="dv">1</span>]</span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: DHS Loadings vs PCA Loadings</span></span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(<span class="at">x =</span> dhs_factor_score, <span class="at">y =</span> r_pca_loading)) <span class="sc">+</span></span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"DHS Loadings vs. PCA Loadings"</span>,</span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"DHS Factor Loadings"</span>,</span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Reproduced PCA Loadings"</span></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03-wealth-index_files/figure-html/dhs_2008-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph compares the PCA loadings corresponding to each variable that we obtained from our calculations with the PCA loadings published by DHS on the webpage dedicated to wealth indexes for the Madagascar 2008 survey. Each point represents a variable included in the wealth index calculation, with the x-axis showing the official DHS-reported loadings and the y-axis showing the reproduced loadings. The near-perfect alignment indicates a very high consistency between the two sets of loadings, demonstrating that our reconstruction closely replicates the official DHS calculations. We now compute a correlation test to assess the correspondance.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation and visualization</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>corr_2008_loadings <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(comparison<span class="sc">$</span>dhs_factor_score, comparison<span class="sc">$</span>r_pca_loading)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>corr_2008_loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  comparison$dhs_factor_score and comparison$r_pca_loading
t = 886.51, df = 70, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.9999286 0.9999722
sample estimates:
      cor 
0.9999555 </code></pre>
</div>
</div>
<p>The Pearson correlation between the DHS-published PCA loadings and our reproduced loadings is nearly perfect at 0.99996, with a p-value less than 2.2e-16, confirming the almost perfect correspondence between the two.</p>
<p>Next, we extend the verification to the observation level by comparing the factor scores generated through our procedure with the wealth index scores (hv271) provided in the DHS dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: hv271 vs Factor Score</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_2008_rec, <span class="fu">aes</span>(<span class="at">x =</span> hv271, <span class="at">y =</span> factor_score)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"hv271 vs Computed Factor Score"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"hv271 (Wealth Index Score)"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Computed Factor Score"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03-wealth-index_files/figure-html/dhs_2008_plot_factors-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>his graph compares the wealth index scores provided in the DHS dataset (<code>hv271</code>) with the factor scores computed through our reconstructed PCA process for the Madagascar 2008 survey. Each point represents a household, with the x-axis showing the DHS wealth index scores and the y-axis displaying the reproduced factor scores. The near-perfect alignment along the regression line demonstrates a very high agreement between the two scores, suggesting that our calculation method effectively replicates the wealth index values at the household level.</p>
<p>We perform a correlation test to quantify the relationship between the DHS wealth index scores (hv271) and the computed factor scores.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a correlation test between hv271 and factor_score</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>corr_2008_obs <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(hh_2008_rec<span class="sc">$</span>hv271, hh_2008_rec<span class="sc">$</span>factor_score,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method =</span> <span class="st">"spearman"</span>, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>corr_2008_obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  hh_2008_rec$hv271 and hh_2008_rec$factor_score
S = 1996791089, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.9978959 </code></pre>
</div>
</div>
<p>The Spearman rank correlation between the official DHS wealth index score (<code>hv271</code>) and our reconstructed factor score for 2008 is very high (ρ = 0.998), suggesting a near-monotonic relationship between the two. Despite tied ranks in the data—common in categorical or discretized variables—the result indicates that our PCA-based replication closely approximates the household ranking used in the DHS wealth index. While this does not imply exact agreement in scale or distribution, it supports the use of the reconstructed score as a valid proxy for household wealth ordering.</p>
<p>We now turn to reconstructing the domain-specific wealth scores (hv271a), which DHS computes separately for urban and rural households using different sets of variables. To replicate this approach, we split the dataset by urban/rural status (hv025), filtered out variables with zero variance within each subgroup, and performed separate principal component analyses (PCA) for urban and rural samples. Using the resulting loadings, we computed domain-specific scores for each household (domscor), then rescaled these scores through linear transformation to approximate the scale of the DHS-provided hv271a variable. We assessed the accuracy of our reconstruction by comparing domscor with hv271a graphically and using Spearman correlation, providing an indication of how well our method reproduces the within-domain household rankings used in the original DHS analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure missing values are handled consistently</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>hh_2008_rec <span class="ot">&lt;-</span> hh_2008_rec <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(animal_husbandry_vars), <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.) <span class="sc">|</span> hv246 <span class="sc">!=</span> <span class="dv">1</span>, <span class="dv">0</span>, .))) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(dich_vars_2008), <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="dv">0</span>)))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to remove zero-variance variables</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>remove_zero_var <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var_list) {</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  zero_vars <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(var_list)) <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">var</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(variance <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(variable)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setdiff</span>(var_list, zero_vars)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify valid variables separately for urban and rural</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>urban_vars <span class="ot">&lt;-</span> <span class="fu">remove_zero_var</span>(hh_2008_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>), all_factor_vars_2008)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>rural_vars <span class="ot">&lt;-</span> <span class="fu">remove_zero_var</span>(hh_2008_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>), all_factor_vars_2008)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Run PCA</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>pca_urban_2008 <span class="ot">&lt;-</span> <span class="fu">perform_pca</span>(hh_2008_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>), urban_vars)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>pca_rural_2008 <span class="ot">&lt;-</span> <span class="fu">perform_pca</span>(hh_2008_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>), rural_vars)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute raw scores</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>hh_2008_rec <span class="ot">&lt;-</span> hh_2008_rec <span class="sc">%&gt;%</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">urbscore =</span> <span class="fu">if_else</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(urban_vars))) <span class="sc">%*%</span> pca_urban_2008<span class="sc">$</span>loadings[, <span class="dv">1</span>]),</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">NA_real_</span>),</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">rurscore =</span> <span class="fu">if_else</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(rural_vars))) <span class="sc">%*%</span> pca_rural_2008<span class="sc">$</span>loadings[, <span class="dv">1</span>]),</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">NA_real_</span>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine domain-specific scores</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>hh_2008_rec <span class="ot">&lt;-</span> hh_2008_rec <span class="sc">%&gt;%</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">domscor =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>      hv025 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> urbscore,</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>      hv025 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> rurscore</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only household IDs and domain-specific score</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>hh_2008_hv271a <span class="ot">&lt;-</span> hh_2008_rec <span class="sc">%&gt;%</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hv001, hv002, <span class="at">hv271a =</span> domscor)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Save for later use</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hh_2008_hv271a, <span class="st">"data/derived/hh_2008_hv271a.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To extend the DHS 2008 analysis with a domain-specific wealth index, we computed separate PCA scores for urban and rural households, based on the subset of variables used by DHS in their original index construction. We then assigned to each household a domain-specific wealth score (<code>hv271a</code>) using the appropriate urban or rural PCA loadings. In order to facilitate later merging with other household-level data, we retained only the unique household identifiers (<code>hv001</code>, <code>hv002</code>) along with the computed score. The resulting dataset was saved as an <code>.rds</code> file in the <code>data/derived/</code> directory for use in downstream analyses.</p>
</section>
<section id="calculating-dhs-1997" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="calculating-dhs-1997"><span class="header-section-number">5.7</span> Calculating DHS 1997</h2>
<p>We apply a similar approach for 1997, considering that the DHS program included fewer variables in the computations. The recoding procedures for these variables are not provided and we figured out the procedure by analysing the recoded variable labels and the content of the 1997 questionnaire.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>hh_1997 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/raw/dhs/DHS_1997/MDHR31DT/MDHR31FL.DTA"</span>) </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997 <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Specific to 1997 ---------------------</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Toilet types (latbush below)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fown =</span> <span class="fu">if_else</span>((hv205 <span class="sc">==</span> <span class="dv">10</span> <span class="sc">|</span> hv205 <span class="sc">==</span> <span class="dv">11</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">latpit  =</span> <span class="fu">if_else</span>((hv205 <span class="sc">==</span> <span class="dv">20</span> <span class="sc">|</span> hv205 <span class="sc">==</span> <span class="dv">21</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">latvip =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">22</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">latother =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">96</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">latbush =</span> <span class="fu">if_else</span>(hv205 <span class="sc">==</span> <span class="dv">31</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Phone</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">phone =</span> <span class="fu">if_else</span>(hv221 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same as 2008 ------------------------</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># water source</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2oires =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If piped drinking water in residence"</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2oiwell =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">22</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If has a well in residence"</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2osurf =</span> <span class="fu">if_else</span>(hv201 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">32</span>, <span class="dv">33</span>, <span class="dv">34</span>), <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If uses river, canal or surface water for drinking"</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2ooth =</span> <span class="fu">if_else</span>(hv201 <span class="sc">&gt;</span> <span class="dv">51</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "Other source of drinking water"</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2ocessi =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">23</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If gets water from an open well/hole/cesspool in residence"</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2orain =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">41</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If rain for drinking water"</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2opub =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">13</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If uses a public faucet (piped)"</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2ocesso =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">26</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If gets water from open well/hole/cesspool outside residence"</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2oores =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If has piped water outside residence"</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2bores =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">21</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If has borehole with pump in residence"</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2oboout =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">24</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If has borehole with pump outside of residence"</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2oowell =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">25</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># "If has well outside of residence"</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2otruck =</span> <span class="fu">if_else</span>(hv201 <span class="sc">==</span> <span class="dv">51</span>, <span class="dv">1</span>, <span class="dv">0</span>),<span class="co"># "If gets water from a tanker truck"</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Amenities</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">electric =</span> <span class="fu">if_else</span>(hv206 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">radio =</span> <span class="fu">if_else</span>(hv207 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">tv =</span> <span class="fu">if_else</span>(hv208 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">fridge =</span> <span class="fu">if_else</span>(hv209 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">bicycle =</span> <span class="fu">if_else</span>(hv210 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">motobk =</span> <span class="fu">if_else</span>(hv211 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">car =</span> <span class="fu">if_else</span>(hv212 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># floor type variables</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">dirtfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">woodfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">21</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">palmfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">22</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">parqfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">31</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">vinfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">32</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">tilefloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">33</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">cemtfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">34</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">carpfloo =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">35</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">othfloor =</span> <span class="fu">if_else</span>(hv213 <span class="sc">==</span> <span class="dv">96</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle missing values for hv216 and compute members per sleeping room</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">hv216 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(hv216)<span class="sc">|</span>hv216 <span class="sc">==</span> <span class="dv">0</span>, hv012, hv216),</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsleep =</span> hv012 <span class="sc">/</span> hv216,</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pondération</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">hhmemwt =</span> hv005 <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">*</span> hv012,</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">wt =</span> hv005 <span class="sc">/</span> <span class="dv">1000000</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ownland variable </span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>ir_1997 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/raw/dhs/DHS_1997/MDIR31DT/MDIR31FL.DTA"</span>)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ownland variable for households</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>ownland_by_household <span class="ot">&lt;-</span> ir_1997 <span class="sc">%&gt;%</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(v001, v002, <span class="at">own_land_partner =</span> v707, <span class="at">own_land_respondent =</span> v740) <span class="sc">%&gt;%</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to binary (1 if owns land personally or by family, 0 otherwise)</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">own_land_partner =</span> <span class="fu">if_else</span>(own_land_partner <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">1</span>, <span class="dv">0</span>, <span class="at">missing =</span> <span class="dv">0</span>),</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">own_land_respondent =</span> <span class="fu">if_else</span>(own_land_respondent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">1</span>, <span class="dv">0</span>, <span class="at">missing =</span> <span class="dv">0</span>),</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">own_any_land =</span> own_land_partner <span class="sc">+</span> own_land_respondent) <span class="sc">%&gt;%</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(v001, v002) <span class="sc">%&gt;%</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ownland =</span> <span class="fu">sum</span>(own_any_land, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ownland =</span> <span class="fu">ifelse</span>(ownland <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Add ownland variable to hh_1997 by joining on hv001 and hv002</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ownland_by_household, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hv001"</span> <span class="ot">=</span> <span class="st">"v001"</span>, <span class="st">"hv002"</span> <span class="ot">=</span> <span class="st">"v002"</span>))</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Check number of unmatched (we do not have data for all hh)</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(hh_1997_rec<span class="sc">$</span>ownland))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1622</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1622</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NA in ownland with 0 (if household doesn't have any matching members)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ownland =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(ownland), <span class="dv">0</span>, ownland))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the equivalent variables for 1997 based on SPSS specification and recoded names</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>pca_loading_dhs <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>       <span class="sc">~</span>code,                                            <span class="sc">~</span>variable, <span class="sc">~</span>dhs_factor,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"electric"</span>,                                    <span class="st">"Has electricity"</span>,  <span class="fl">0.15080</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>     <span class="st">"radio"</span>,                                          <span class="st">"Has radio"</span>,  <span class="fl">0.10360</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tv"</span>,                                     <span class="st">"Has television"</span>,  <span class="fl">0.13631</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fridge"</span>,                                   <span class="st">"Has refrigerator"</span>,  <span class="fl">0.08574</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>   <span class="st">"bicycle"</span>,                                        <span class="st">"Has bicycle"</span>,  <span class="fl">0.04035</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"motobk"</span>,                                     <span class="st">"Has motorcycle"</span>,  <span class="fl">0.04297</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>       <span class="st">"car"</span>,                                            <span class="st">"Has car"</span>,  <span class="fl">0.07643</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>     <span class="st">"phone"</span>,                                      <span class="st">"Has telephone"</span>,  <span class="fl">0.06839</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>   <span class="st">"ownland"</span>,     <span class="st">"If household works own or family's agric. land"</span>,  <span class="sc">-</span><span class="fl">0.09713</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"memsleep"</span>,                <span class="st">"Number of members per sleeping room"</span>,  <span class="sc">-</span><span class="fl">0.05370</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>   <span class="st">"h2oires"</span>,               <span class="st">"If piped drinking water in residence"</span>,  <span class="fl">0.11394</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2oiwell"</span>,                         <span class="st">"If has a well in residence"</span>,  <span class="fl">0.01202</span>,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>   <span class="st">"h2osurf"</span>, <span class="st">"If uses river, canal or surface water for drinking"</span>,  <span class="sc">-</span><span class="fl">0.10437</span>,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"h2ooth"</span>,                     <span class="st">"Other source of drinking water"</span>,  <span class="sc">-</span><span class="fl">0.00177</span>,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"fown"</span>,                           <span class="st">"If uses own flush toilet"</span>,  <span class="fl">0.09723</span>,</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2ocessi"</span>,    <span class="st">"Water from open well/hole/cesspool in residence"</span>,  <span class="fl">0.00524</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>   <span class="st">"latbush"</span>,                      <span class="st">"If uses bush,field as latrine"</span>,  <span class="sc">-</span><span class="fl">0.12692</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"latother"</span>,                           <span class="st">"If other type of latrine"</span>,  <span class="fl">0.00208</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dirtfloo"</span>,      <span class="st">"If has dirt, sand, dung as  floor in dwelling"</span>,  <span class="sc">-</span><span class="fl">0.00042</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"woodfloo"</span>,     <span class="st">"If has wood, plank principal floor in dwelling"</span>,  <span class="fl">0.03547</span>,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cemtfloo"</span>,                      <span class="st">"If has cement principal floor"</span>,  <span class="fl">0.08999</span>,</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"othfloor"</span>,                      <span class="st">"If has other type of flooring"</span>,  <span class="sc">-</span><span class="fl">0.00141</span>,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>   <span class="st">"h2orain"</span>,                         <span class="st">"If rain for drinking water"</span>,  <span class="sc">-</span><span class="fl">0.00163</span>,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"h2opub"</span>,                    <span class="st">"If uses a public faucet (piped)"</span>,  <span class="fl">0.08025</span>,</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2ocesso"</span>,         <span class="st">"Water from open well/hole/cesspool outside"</span>,  <span class="sc">-</span><span class="fl">0.02915</span>,</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"latpit"</span>,                   <span class="st">"If uses a traditional pit toilet"</span>,  <span class="fl">0.08954</span>,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"latvip"</span>,                              <span class="st">"If uses a VIP latrine"</span>,  <span class="fl">0.00948</span>,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"parqfloo"</span>,             <span class="st">"If has parquet or polished wood floors"</span>,  <span class="fl">0.07280</span>,</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tilefloo"</span>,            <span class="st">"If has tiles for main flooring material"</span>,  <span class="fl">0.03367</span>,</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"palmfloo"</span>,          <span class="st">"If has palm or bamboo for floor materials"</span>,  <span class="sc">-</span><span class="fl">0.12683</span>,</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"carpfloo"</span>,                           <span class="st">"If has carpeted flooring"</span>,  <span class="fl">0.01799</span>,</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>   <span class="st">"h2oores"</span>,               <span class="st">"If has piped water outside residence"</span>,  <span class="fl">0.01861</span>,</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>   <span class="st">"h2bores"</span>,             <span class="st">"If has borehole with pump in residence"</span>,  <span class="fl">0.01642</span>,</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2oboout"</span>,     <span class="st">"If has borehole with pump outside of residence"</span>,  <span class="sc">-</span><span class="fl">0.01110</span>,</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2oowell"</span>,                   <span class="st">"If has well outside of residence"</span>,  <span class="sc">-</span><span class="fl">0.00205</span>,</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h2otruck"</span>,                  <span class="st">"If gets water from a tanker truck"</span>,  <span class="sc">-</span><span class="fl">0.00265</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>all_factor_vars_1997 <span class="ot">&lt;-</span> pca_loading_dhs<span class="sc">$</span>code</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace missing values</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(all_factor_vars_1997),</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.), <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .)))</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>pca_result_1997 <span class="ot">&lt;-</span> <span class="fu">perform_pca</span>(hh_1997_rec, all_factor_vars_1997)</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Add factor scores to the dataset</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">factor_score =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(hh_1997_rec <span class="sc">%&gt;%</span> </span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">select</span>(<span class="fu">all_of</span>(all_factor_vars_1997))) <span class="sc">%*%</span> </span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>                               pca_result_1997<span class="sc">$</span>loadings[, <span class="dv">1</span>]))</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tibble for DHS scores and R PCA loadings</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>r_pca_loadings <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">code =</span> <span class="fu">rownames</span>(pca_result_1997<span class="sc">$</span>loadings),</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">r_pca_loading =</span> <span class="fu">as.vector</span>(pca_result_1997<span class="sc">$</span>loadings[, <span class="dv">1</span>])</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the tibbles and calculate differences</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">left_join</span>(pca_loading_dhs, r_pca_loadings, <span class="at">by =</span> <span class="st">"code"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> r_pca_loading <span class="sc">-</span> dhs_factor)</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: DHS Loadings vs PCA Loadings</span></span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(<span class="at">x =</span> dhs_factor, <span class="at">y =</span> r_pca_loading)) <span class="sc">+</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"DHS Loadings vs. PCA Loadings (1997)"</span>,</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"DHS Factor Loadings"</span>,</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Reproduced PCA Loadings"</span></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03-wealth-index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph compares the PCA loadings provided by DHS with the reproduced loadings generated through our reconstruction of the wealth index for the 1997 Madagascar survey. Each point represents a variable used in the wealth index calculation, with the x-axis displaying the DHS-provided loadings and the y-axis showing the reproduced loadings. The alignment of points along the regression line indicates a very strong correspondence between the two sets of loadings, validating our reconstruction methodology.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<pre class="rdhs_1997_corr_loadings cell-code"><code>
# Calculate and print the correlation
correlation &lt;- cor.test(comparison$dhs_factor, comparison$r_pca_loading, use = "complete.obs")
print(correlation)</code></pre>
</details>
</div>
<p>The correlation test confirms the strong relationship between the DHS-provided PCA loadings and our reproduced loadings, with a correlation coefficient of 0.9929. The extremely small p-value (&lt; 2.2e-16) indicates that this correspondence is statistically significant.</p>
<p>We compute both a national and a domain-specific wealth index for the 1997 DHS dataset. Since DHS did not publish official wealth scores for this round, we generate a synthetic index following the same methodology: we perform PCA on recoded household-level variables and retain the first component as the national wealth index (saved under hv271). We also replicate the DHS practice of estimating separate scores for urban and rural households, applying PCA separately to each group and combining the resulting scores into a domain-specific index (saved under hv271a).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure missing values are handled for all relevant variables</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(all_factor_vars_1997), <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.), <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .)))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove zero-variance variables by domain</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>urban_vars_1997 <span class="ot">&lt;-</span> <span class="fu">remove_zero_var</span>(hh_1997_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>), all_factor_vars_1997)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>rural_vars_1997 <span class="ot">&lt;-</span> <span class="fu">remove_zero_var</span>(hh_1997_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>), all_factor_vars_1997)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA per domain</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>pca_urban_1997 <span class="ot">&lt;-</span> <span class="fu">perform_pca</span>(hh_1997_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>), urban_vars_1997)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>pca_rural_1997 <span class="ot">&lt;-</span> <span class="fu">perform_pca</span>(hh_1997_rec <span class="sc">%&gt;%</span> <span class="fu">filter</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>), rural_vars_1997)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Domain-specific raw scores</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">urbscore =</span> <span class="fu">if_else</span>(hv025 <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(urban_vars_1997))) <span class="sc">%*%</span> pca_urban_1997<span class="sc">$</span>loadings[, <span class="dv">1</span>]),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">NA_real_</span>),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">rurscore =</span> <span class="fu">if_else</span>(hv025 <span class="sc">==</span> <span class="dv">2</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(rural_vars_1997))) <span class="sc">%*%</span> pca_rural_1997<span class="sc">$</span>loadings[, <span class="dv">1</span>]),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">NA_real_</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute final scores</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>hh_1997_rec <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">hv271 =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(all_factor_vars_1997))) <span class="sc">%*%</span> pca_result_1997<span class="sc">$</span>loadings[, <span class="dv">1</span>]), <span class="co"># common</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">hv271a =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>      hv025 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> urbscore,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>      hv025 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> rurscore</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="co"># domain-specific</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only identifiers and the two wealth indices</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>hh_1997_pca_scores <span class="ot">&lt;-</span> hh_1997_rec <span class="sc">%&gt;%</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hv001, hv002, hv271, hv271a)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to file</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hh_1997_pca_scores, <span class="st">"data/derived/hh_1997_hv271_hv271a.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion</h1>
<p>These results confirm the reliability of our methodology in replicating the wealth index calculations for the DHS 1997 and 2008 surveys. We will be able to use these to compute wealth scores dedicated to the rural areas, equivalent to <strong>HV270A</strong> and <strong>HV271A</strong>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/betsaka\.github\.io\/PA-livelihood-impact-dhs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02bis-spei-calculation.html" class="pagination-link" aria-label="SPEI Calculation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">SPEI Calculation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-variable-consolidation.html" class="pagination-link" aria-label="Consolidation">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Consolidation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>