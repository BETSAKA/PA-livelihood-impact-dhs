---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Consolidation

L'objectif de ce document est de combiner les clusters de 1997, 2008 et 2021 avec leurs caractéristiques géophysiques et en ajoutant la variable de résultat dans le dataframe

```{r}

library(dplyr)
library(readr)
library(sf)
library(haven)

# Load data 
spatial_covars_spei <- readRDS("data/derived/spatial_covars_spei.rds") # Données geophysiques des ménages 
hh_1997_hv271_hv271a <- read_rds("data/derived/hh_1997_hv271_hv271a.rds") # wealth index factor et wealth index factor rural 1997
hr_1997 <- read_dta("data/raw/dhs/DHS_1997/MDHR31DT/MDHR31FL.DTA")
hh_2008_hv271a <- read_rds("data/derived/hh_2008_hv271a.rds") # wealth index factor rural 2008
hr_2008 <- read_dta("data/raw/dhs/DHS_2008/MDHR51DT/MDHR51FL.DTA")
hr_2021 <- read_dta("data/raw/dhs/DHS_2021/MDHR81DT/MDHR81FL.DTA")

# Ajout des wealth index avec les données physiques des ménages
# 1997
merged_1997 <- spatial_covars_spei %>%
  filter(DHSYEAR == 1997)

merged_1997 <- hh_1997_hv271_hv271a %>% 
  left_join(merged_1997, by = c("hv001" = "DHSCLUST")) 

# 2008
hr_2008_selected <- hr_2008 %>%
  dplyr:: select(
    hv001, hv025,hv271
  )

merged_2008 <- spatial_covars_spei %>%
  filter(DHSYEAR == 2008)
  
merged_2008 <- hh_2008_hv271a %>%
  left_join(merged_2008, by = c("hv001" = "DHSCLUST"))

# 2021
hr_2021_selected <- hr_2021 %>%
  dplyr:: select(
    hv001, hv271, hv271a
  )

merged_2021 <- spatial_covars_spei %>%
  filter(DHSYEAR == 2021)

merged_2021 <- hr_2021_selected %>%
  left_join(merged_2021, by = c("hv001" = "DHSCLUST")) 

# Combiner les résultats 
merged_all <- bind_rows(
  merged_1997, 
  merged_2008,
  merged_2021
)

```

## 
