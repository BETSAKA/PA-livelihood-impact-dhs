---
title: "Data on protected areas"
author: "Iriana Razafimahenina"
format: html
editor: visual
---

## Data on protected areas

Nous utilisons les données du Système des Aires Protégées à Madagascar (SAPM) obtenues auprès du Service de la Gouvernance des Aires Protégées (SGAP) du Ministère de l'Environnement et du Développement Durable.

```{r }
# Library 
library(tidyverse)
library(lubridate)
library(haven)
library(sf)
library(tmap)
library(codebook)
library(wdpar) #données sur les AP
library(gt)
library(writexl)
library(pwr)
library(lme4) # Estimation des modèles linéaires 
library(units) # Gestion des unités de mesure
library(dplyr)


# Load boundary
  if (file.exists("Data/contour_mada.rds")) {
  contour_mada <- read_rds("Data/contour_mada.rds") 
} else {
  contour_mada <- gadm(country = "Madagascar", level = 0, path = "Data") %>%
    st_as_sf() %>%
    st_transform(29702)
  saveRDS(contour_mada, "Data/contour_mada.rds")
}
 
mada_area <- set_units(st_area(contour_mada), km^2)
tmap_mode("view")
tm_shape(contour_mada) + 
  tm_borders()


# Load DHS data 
sapm <- st_read("C:/Users/irian/Documents/IRD_Drive/BETSAKA_MADAGASCAR/Données/Aires protégées/SAPM_2017_corrected/SAPM_2017_corrected.shp", quiet = TRUE) %>%
 st_transform(29702) %>%
  st_make_valid() %>%
  mutate(YEAR_CREAT = year(ymd(DATE_CREAT)), .after = DATE_CREAT)

# Save tabular data to Excel
sapm_tb <- sapm %>%
  st_drop_geometry()


write_xlsx(sapm_tb, "C:/Users/irian/Documents/IRD_Drive/BETSAKA_MADAGASCAR/Données/Aires protégées/SAPM_2017_corrected/SAPM_2017_corrected.xlsx")

# Compute PA area
sapm_area <- st_area(sapm) %>%
  set_units(km^2)
sapm_area

# Calcul de la proportion de la superficie des AP de SAPM par rapport à la superficie totale de Madagascar
proportion_sapm_mada <- sapm_area / mada_area
proportion_sapm_mada

# Intersection des SAPM avec la limite de Madagascar
sapm_land <- sapm %>% 
  st_intersection(contour_mada)%>%
  st_make_valid() 

# Calcul de la superficie des SAPM à l'intérieur de Madagascar
sapm_land_area <- st_area(sapm_land) %>%
  set_units(km^2)
sapm_land_area

# Calcul de la proportion de la superficie des AP sur les terres de Madagascar
proportion_sapm_land_mada <- sapm_land_area / mada_area
proportion_sapm_land_mada

# Visualisation
tmap_mode("view")
tm_shape(contour_mada) +
  tm_borders() +
tm_shape(sapm) +
  tm_polygons(col = "green", id = "FULL_NAME", popup.vars = c("Superficie (ha)" = "HECTARES")) +
  tm_scalebar(position = c("left", "bottom")) + 
  tmap_options(check_and_fix = TRUE) +
  tm_title("Aires protégées de Madagascar") +
  tm_layout(legend.outside = TRUE)

```
