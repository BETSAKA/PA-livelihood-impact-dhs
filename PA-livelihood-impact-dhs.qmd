---
title: "PA-livelihood-impact-dhs"
author: "Iriana Razafimahenina"
format: 
  html:
   out-put-file: index.html
   embed-resources: true
   standalone: true
   code-fold: true
  execute: 
   warning: false
   error: false
editor: visual
editor-options: 
   chunk_out_type: console
Bibliography: references.bib
---

## Environnement

```{r}
library(tidyverse) #Manipulation et visualisation des données
library(haven) #Importation des données
library(writexl) #Exportation des données
library(sf) #Analyse des données spatiales
library(tmap) #Analyse cartographique
library(codebook) #Documentation et mise en forme des données 
library(gt) #Mise en forme des tableaux 
library(survey) #Analyse des données d'enquêtes
library(MatchIt) #Matching
library(ggplot2) #Figure

```

## Data structuring

Nous allons charger les données nécessaires à l'analyse.

## Socioeconomic household data

```{r}
#Définition du chemin du dossier principal
main_folder <- "../../IRD_Drive/BETSAKA_MADAGASCAR/Données/Enquêtes ménages/DHS Madagascar/DHS_data/"

#Load DHS data
load_data <- function(year){
  year_folder <- paste0(main_folder, "DHS_", year)
  
#Get the .shp (GPS) and .dta (household) file paths
  
  shp_path <- list.files(year_folder, pattern = "\\.shp$", full.names = TRUE, recursive = TRUE)
  
  hr_path <- list.files(year_folder, pattern = ".*HR.*\\.dta$", full.names = TRUE, recursive = TRUE, ignore.case = TRUE)
  
#Check that there is only one match per year
  if(length(shp_path)!=1 | length(hr_path) != 1) {
    stop(paste0("Erreur : ", length(shp_path), " fichier(s) .shp trouvés pour l'année", year, length(hr_path), " fichier(s) .dta trouvés pour l'année", year, " (attendu : 1 de chaque). Vérifiez le dossier."))
  }
#Read the data
  gps_data <- st_read(shp_path, quiet = TRUE) %>%
    st_transform(4326) #Lecture du fichier .shp
  
  household_data <- read_dta(hr_path) #Lecture du fichier .dta

#Retourner une liste contenant les deux jeux de données 
  return(list(GPS = gps_data, Households = household_data))
}
  
#Exécuter la fonction pour une année spécifique
  dhs_1997 <- load_data(1997)
  dhs_2008 <- load_data(2008)
  dhs_2021 <- load_data(2021)

```
